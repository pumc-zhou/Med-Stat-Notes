<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-Hans" xml:lang="zh-Hans"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Simonzhou">

<title>用Python和Stata处理一份卫生费用数据 – 医学统计学笔记</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../Guide/SAS/SAS-intro.html" rel="next">
<link href="../../Guide/Python/Python-intro.html" rel="prev">
<link href="../../images/logo.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-8ea72dc5fed832574809a9c94082fbbb.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-471db41ce322a552900897f16bd8eadd.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-39599dd41c217de25ded3edcfc388f1c.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "没有结果",
    "search-matching-documents-text": "匹配的文档",
    "search-copy-link-title": "复制搜索链接",
    "search-hide-matches-text": "隐藏其它匹配结果",
    "search-more-match-text": "更多匹配结果",
    "search-more-matches-text": "更多匹配结果",
    "search-clear-button-title": "清除",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "取消",
    "search-submit-button-title": "提交",
    "search-label": "搜索"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-G2HZEXHNCE"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-G2HZEXHNCE', { 'anonymize_ip': true});
</script>
<style>html{ scroll-behavior: smooth; }</style>


<meta property="og:title" content="用Python和Stata处理一份卫生费用数据 – 医学统计学笔记">
<meta property="og:description" content="This is a Note site.">
<meta property="og:image" content="www.lazyzhou.cn/Guide/Python/images/logo.png">
<meta property="og:site_name" content="医学统计学笔记">
<meta name="twitter:title" content="用Python和Stata处理一份卫生费用数据 – 医学统计学笔记">
<meta name="twitter:description" content="This is a Note site.">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar docked nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">一份医学统计学习笔记</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="搜索"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="展开或折叠导航栏" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../../index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-learn" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Learn</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-learn">    
        <li>
    <a class="dropdown-item" href="../../Learn/Basic/00-basic.html">
 <span class="dropdown-text">Basic</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Learn/Bayes/00-About-Bayes.html">
 <span class="dropdown-text">Bayes</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-guide" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Guide</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-guide">    
        <li>
    <a class="dropdown-item" href="../../Guide/Guide-intro.html">
 <span class="dropdown-text">Guide</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Guide/Python/Python-intro.html">
 <span class="dropdown-text">Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Guide/R/R-intro.html">
 <span class="dropdown-text">R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Guide/SAS/SAS-intro.html">
 <span class="dropdown-text">SAS</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-quarto" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Quarto</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-quarto">    
        <li>
    <a class="dropdown-item" href="../../Quarto/quarto-intro.html">
 <span class="dropdown-text">Intro</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../navbar/book.html"> 
<span class="menu-text">Books</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://github.com/zhoulvbang" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="切换深色模式"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="切换阅读器模式">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="展开或折叠侧边栏导航" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../Guide/Guide-intro.html">统计软件使用指南</a></li><li class="breadcrumb-item"><a href="../../Guide/Python/Python-intro.html">Python introduction</a></li><li class="breadcrumb-item"><a href="../../Guide/Python/2025-02-20-Medical-expenses.html">用Python和Stata处理一份卫生费用数据</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="展开或折叠侧边栏导航" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">主页</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../Learn/Basic/00-basic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">医学统计学基础</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../Learn/Basic/00-basic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">医学统计学基础</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Learn/Basic/00-basic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">医学统计学基础</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Learn/Basic/01-preview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">关于卫生统计学</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Learn/Basic/02-descriptive-statistics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">不同资料的统计描述</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Learn/Basic/03-Random-events-probabilities.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">随机事件的概率</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Learn/Basic/04-discrete-type-random-variable.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">离散型随机变量的概率分布</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Learn/Basic/05-random-variable-of-continuous-type.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">连续型随机变量的概率分布</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Learn/Basic/06-parameter-estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">参数估计</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Learn/Basic/07-parameter-test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">参数检验</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Learn/Basic/08-anova-test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">方差分析</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Learn/Basic/09-non-parameter-test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">非参数检验</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Learn/Basic/10-regression-correlation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">简单线性相关和回归</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../Learn/Bayes/00-About-Bayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">贝叶斯与概率推理</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Learn/Bayes/00-About-Bayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">贝叶斯与概率推理</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Learn/Bayes/01-Bayes-PGM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">贝叶斯与概率图模型（PGM）</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../Guide/Guide-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">统计软件使用指南</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../Guide/R/R-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R introduction</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Guide/R/2025-02-22-CLHLS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CLHLS Data Analysis by R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Guide/R/R-install.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">MacOS安装 R 和 Rstudio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Guide/R/R-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R introduction</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../Guide/Python/Python-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Guide/Python/2025-02-20-Medical-expenses.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">用Python和Stata处理一份卫生费用数据</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Guide/Python/Python-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python introduction</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../Guide/SAS/SAS-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SAS introduction</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="false" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Guide/SAS/2025-02-16-CLHLS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">使用SAS处理CLHLS数据</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Guide/SAS/SAS-install.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SAS Install</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Guide/SAS/SAS-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SAS introduction</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../Quarto/quarto-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quarto introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Quarto/config-giscus-github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Qmd config giscus</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Quarto/quarto-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quarto introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Quarto/quarto-LaTeX.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quarto与LaTeX的记录</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../Guide/Guide-intro.html">统计软件使用指南</a></li><li class="breadcrumb-item"><a href="../../Guide/Python/Python-intro.html">Python introduction</a></li><li class="breadcrumb-item"><a href="../../Guide/Python/2025-02-20-Medical-expenses.html">用Python和Stata处理一份卫生费用数据</a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">用Python和Stata处理一份卫生费用数据</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> 代码</button></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">作者</div>
    <div class="quarto-title-meta-contents">
             <p>Simonzhou </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">发布于</div>
    <div class="quarto-title-meta-contents">
      <p class="date">2025年2月20日</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="用python处理卫生费用数据" class="level1">
<h1>用Python处理卫生费用数据</h1>
<p>本篇博客用来记录2025年1月到2月帮助学弟处理一份某二级医院2018-2023年的医疗费用，最开始用的Stata，但是越往后，越感觉到Stata的难用，以及AI对这种程序的支持程度极其有限，随改用 <code>Python + Stata</code> 来继续完成相关的分析。</p>
<section id="必须配置" class="level2">
<h2 class="anchored" data-anchor-id="必须配置">必须配置</h2>
<p>运行此文档需要电脑上以安装Python，并且下列包已被安装并且能被调用：</p>
<p><code>numpy jupyter-cache pandas openpyxl</code></p>
<p>你可以使用 <code>pip</code> 或 <code>conda</code> 进行安装： <code>pip install jupyter-cache</code></p>
</section>
<section id="初步认识数据" class="level2">
<h2 class="anchored" data-anchor-id="初步认识数据">初步认识数据</h2>
<p>我们可以使用<code>pandas</code>包来查看部分原始数据，数据的基本样式如下：</p>
<div id="aa970758" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 安装并加载必要的包</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 导入 Excel 文件</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> <span class="st">"C:/Users/asus/Desktop/test/stata/prepare.xlsx"</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_excel(file_path, sheet_name<span class="op">=</span><span class="dv">0</span>, engine<span class="op">=</span><span class="st">'openpyxl'</span>)     </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 数据脱敏，删除地方</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>columns_to_drop <span class="op">=</span> [<span class="st">"籍贯"</span>, <span class="st">"出生地"</span>]</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.drop(columns<span class="op">=</span>columns_to_drop, errors<span class="op">=</span><span class="st">'ignore'</span>)  <span class="co"># errors='ignore' 防止列不存在时报错</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 随机抽取10个样本数据</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>sample_data <span class="op">=</span> data.sample(n<span class="op">=</span><span class="dv">10</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 打印样本数据</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sample_data)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      次数        出生日期 性别   年龄      医疗付费方式  国籍 新生儿出生体重 新生儿入院体重  民族     职业  ...  \
1138   1  1956-09-06  男  61岁    新型农村合作医疗  中国       －       －  汉族     农民  ...   
2024   1  1959-08-15  女  59岁  城镇居民基本医疗保险  中国       －       －  汉族     居民  ...   
1605   1  1973-02-05  女  45岁    新型农村合作医疗  中国       －       －  汉族     农民  ...   
1975  11  2012-09-20  男   6岁    新型农村合作医疗  中国       －       －  汉族  学龄前儿童  ...   
1701   1  1963-01-23  男  55岁         全自费  中国       －       －  汉族      无  ...   
218    1  1969-06-08  女  48岁    新型农村合作医疗  中国       －       －  汉族     农民  ...   
1344   1  1960-09-11  女  57岁    新型农村合作医疗  中国       －       －  汉族     务农  ...   
252    1  1944-05-01  女  73岁    新型农村合作医疗  中国       －       －  汉族     农民  ...   
1921   5  2013-10-17  女   5岁    新型农村合作医疗  中国       －       －  汉族  学龄前儿童  ...   
643    1  1997-09-02  男  20岁         全自费  中国       －       －  汉族     战士  ...   

     麻醉开始时间3 麻醉结束时间3 麻醉方式3 麻醉分级3  切口部位3 切口等级3 NNIS分级3  手术部位感染3  术前住院天数3  \
1138     NaN     NaN   NaN   NaN    NaN   NaN     NaN      NaN      NaN   
2024     NaN     NaN   NaN   NaN    NaN   NaN     NaN      NaN      NaN   
1605     NaN     NaN   NaN   NaN    NaN   NaN     NaN      NaN      NaN   
1975     NaN     NaN   NaN   NaN    NaN   NaN     NaN      NaN      NaN   
1701     NaN     NaN   NaN   NaN    NaN   NaN     NaN      NaN      NaN   
218      NaN     NaN   NaN   NaN    NaN   NaN     NaN      NaN      NaN   
1344     NaN     NaN   NaN   NaN    NaN   NaN     NaN      NaN      NaN   
252      NaN     NaN   NaN   NaN    NaN   NaN     NaN      NaN      NaN   
1921     NaN     NaN   NaN   NaN    NaN   NaN     NaN      NaN      NaN   
643      NaN     NaN   NaN   NaN    NaN   NaN     NaN      NaN      NaN   

     手术持续时间3  
1138     NaN  
2024     NaN  
1605     NaN  
1975     NaN  
1701     NaN  
218      NaN  
1344     NaN  
252      NaN  
1921     NaN  
643      NaN  

[10 rows x 200 columns]</code></pre>
</div>
</div>
<p>我们可以看到，该数据的列很多，第一张表中有200列，我们需要对其进行一些筛选。</p>
</section>
<section id="对数据的思考" class="level2">
<h2 class="anchored" data-anchor-id="对数据的思考">对数据的思考</h2>
<p>从哪里开始是一个需要思考的问题，对于数据的认识决定了你处理问题的方向和效率。首先，理解数据的来源至关重要，这包括了解数据是如何收集的、收集过程中可能出现的偏差或错误。其次，明确数据的类型与结构也是关键步骤之一，不同类型的数据（如定量数据、定性数据）需要采用不同的分析方法。再者，对数据进行初步探索，比如通过可视化手段观察数据分布特征，或是计算一些基本统计量来了解数据的基本情况，能够帮助你更好地制定数据处理策略。</p>
<p>在真正开始处理数据之前，还需要考虑你的目标是什么。是为了回答一个具体的问题，还是为了探索潜在的模式？明确了目标之后，才能有针对性地选择合适的工具和技术。此外，考虑到数据质量的问题，数据清洗是不可跳过的一步，它包括去除异常值、填补缺失值等操作，这对于提高分析结果的准确性非常关键。</p>
<p>最后，保持对数据伦理的关注同样重要，在整个数据分析的过程中，确保遵循相关的隐私保护法规和道德标准，这样才能确保你的工作不仅有效，而且负责任。通过对数据全面而深刻的理解，你可以更加自信地从数据中提取有价值的信息，并为决策提供有力支持。</p>
<section id="合并数据" class="level3">
<h3 class="anchored" data-anchor-id="合并数据">合并数据</h3>
<p>这份Excel文件有6张sheet，分别是2018-2023年，首先需要检查这六张sheet中的变量是否一致：</p>
<div id="3b94a9f8" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 导入 Excel 文件</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> <span class="st">"C:/Users/asus/Desktop/test/stata/prepare.xlsx"</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>sheet_names <span class="op">=</span> [<span class="st">"2018"</span>, <span class="st">"2019"</span>, <span class="st">"2020"</span>, <span class="st">"2021"</span>, <span class="st">"2022"</span>, <span class="st">"2023"</span>]</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 读取所有 sheet 的数据</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>sheets_data <span class="op">=</span> {sheet: pd.read_excel(file_path, sheet_name<span class="op">=</span>sheet) <span class="cf">for</span> sheet <span class="kw">in</span> sheet_names}</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 获取每个 sheet 的列名</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>sheets_columns <span class="op">=</span> {sheet: <span class="bu">set</span>(data.columns) <span class="cf">for</span> sheet, data <span class="kw">in</span> sheets_data.items()}</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 找出所有 sheet 的共同变量和不一致的变量</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>common_columns <span class="op">=</span> <span class="bu">set</span>.intersection(<span class="op">*</span>sheets_columns.values())</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>all_columns <span class="op">=</span> <span class="bu">set</span>.union(<span class="op">*</span>sheets_columns.values())</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>inconsistent_columns <span class="op">=</span> all_columns <span class="op">-</span> common_columns</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 打印结果</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"一致的变量名:"</span>)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(common_columns)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">不一致的变量名:"</span>)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(inconsistent_columns)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 打印每个 sheet 的变量</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> sheet, columns <span class="kw">in</span> sheets_columns.items():</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span>sheet<span class="sc">}</span><span class="ss"> 的变量: </span><span class="sc">{</span>columns<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>一致的变量名:
{'目的', '断脐后预防性使用抗菌药物给药时间1', '6麻醉方式', '1愈合', '死亡患者尸检', '入院途径', '2.4临床诊断项目费', '清洁手术预防使用抗菌药物总天数', '麻醉结束时间1', '麻醉结束时间2', '术前使用预防性抗菌药物1', '10.其他费', '新生儿出生体重', '6.2抗菌药物费用', '7.2中草药费', '出生地', '抗菌药物使用天数', '1级别', '新生儿入院体重', '5.中医治疗费', '手术持续时间1', '术前住院天数2', '切口部位1', '病室', '性别', '病室.1', '是否有出院31天内再住院计划', '3愈合', '总药品费', '9.3手术用一次性医用材料费', '手术开始时间2', '术前使用预防性抗菌药物2', '入院诊断', '手术次数2', '断脐后预防性使用抗菌药物给药时间2', '麻醉开始时间1', '是否有使用抗菌药物2', '麻醉分级2', '3麻醉方式', '职业', '2愈合', '手术部位感染2', '5愈合', '术前预防性抗菌药物给药时间1', '1.3护理费', '输血反应', '1.1一般医疗服务费', 'RH', '2手术编码', '8.4凝血因子类制品费', '9.1检查用一次性医用材料费', '术前预防性抗菌药物给药时间2', '1手术时间', '手术操作名称1', '是否非计划重返手术室病例2', '2切口', '3手术时间', '是否有使用抗菌药物1', '入院日期', '出院诊断', '手术次数1', '血管介入治疗', '4手术编码', '6切口', '输液反应', '3.4麻醉费', '麻醉分级1', '6愈合', '患者入住重症监护室（ICU）情况', '3手术编码', '预防性抗菌药物使用时机2', '入院科别', '是否微创手术1', '药占比%', '5切口', '腔镜手术名称2', '6.1西药费', '切口等级1', '出院科别', '4切口', '出生日期', '2手术名称', '输血反应次数', '感染情况', '3手术名称', '出院日期', '细菌名称2', '是否非计划重返手术室病例1', '血管介入治疗抗菌药物使用天数', '手术预防性使用抗菌药物天数2', '1麻醉方式', '3.1非手术治疗项目费', '4愈合', '1手术名称', '5级别', '病案质量', '1.2一般治疗操作费', '术后预防性抗菌药物结束时间2', '3级别', '4手术名称', '手术操作名称2', '国籍', '是否在术后使用预防性抗菌药物2', '7.1中成药费', '8.1血费', '医疗付费方式', '9.2治疗用一次性医用材料费', '本次住院期间有无重返手术室的计划1', '6手术时间', '5手术名称', '自付金额', '离院方式', '6手术名称', '择期手术1', '手术操作编码2', '病理诊断', '细菌名称4', '6手术编码', '输液反应次数', '3.3手术治疗费', '手术部位感染1', '次数', '2麻醉方式', '3切口', '是否临床路径', '婚姻', '2.1病理诊断费', '入院前颅脑损伤昏迷时间', '本次住院期间有无重返手术室的计划2', '手术操作编码1', '麻醉开始时间2', '3.5手术费', '预防性抗菌药物使用时机1', 'NNIS分级2', '3.2临床物理治疗费', '6级别', 'NNIS分级1', '5手术时间', '2手术时间', '术后预防性抗菌药物结束时间1', '手术持续时间2', '1.4其他费用', '是否在术后使用预防性抗菌药物1', '手术结束时间1', '择期手术2', '麻醉方式1', '手术开始时间1', '切口等级2', '切口部位2', '年龄', '4.康复费', '民族', '血型', '术前住院天数1', '5手术编码', '2.2实验室诊断费', '院内感染', '1切口', '籍贯', '愈合1', '住院天数', '4级别', '总费用', '清洁手术预防使用抗菌药物品种数', '1手术编码', '手术预防性使用抗菌药物天数1', '8.3球蛋白类制品费', '腔镜手术名称1', '手术结束时间2', '2级别', '药物过敏', '5麻醉方式', '2.3影像学诊断费', '麻醉方式2', '4手术时间', '入院后颅脑损伤昏迷时间', '级别2', '8.2白蛋白类制品费', '细菌名称1', '是否药物过敏', '细菌名称3', '8.5细胞因子类制品费', '级别1'}

不一致的变量名:
{'愈合2', '手术开始时间3', '7手术编码', '7级别', '7切口', '手术部位感染3', '手术次数3', '8麻醉方式', '7手术时间', '手术持续时间3', '是否微创手术2', '8手术时间', '8愈合', '4麻醉方式', '麻醉开始时间3', '术前住院天数3', '切口部位3', 'NNIS分级3', '8切口', '麻醉结束时间3', '麻醉分级3', '8手术编码', '切口等级3', '手术操作名称3', '麻醉方式3', '手术操作编码3', '8级别', '4麻醉医师', '8手术名称', '7愈合', '手术结束时间3', '择期手术3', '7手术名称', '7麻醉方式'}

2018 的变量: {'目的', '愈合2', '断脐后预防性使用抗菌药物给药时间1', '6麻醉方式', '手术开始时间3', '死亡患者尸检', '1愈合', '入院途径', '2.4临床诊断项目费', '清洁手术预防使用抗菌药物总天数', '麻醉结束时间1', '麻醉结束时间2', '术前使用预防性抗菌药物1', '10.其他费', '新生儿出生体重', '6.2抗菌药物费用', '7.2中草药费', '出生地', '抗菌药物使用天数', '1级别', '新生儿入院体重', '5.中医治疗费', '手术持续时间1', '术前住院天数2', '切口部位1', '病室', '性别', '病室.1', '是否有出院31天内再住院计划', '3愈合', '总药品费', '9.3手术用一次性医用材料费', '手术开始时间2', '术前使用预防性抗菌药物2', '入院诊断', '手术次数2', '断脐后预防性使用抗菌药物给药时间2', '麻醉结束时间3', '麻醉开始时间1', '切口等级3', '是否有使用抗菌药物2', '麻醉分级2', '3麻醉方式', '职业', '2愈合', '手术部位感染2', '麻醉方式3', '5愈合', '术前预防性抗菌药物给药时间1', '1.3护理费', '输血反应', '1.1一般医疗服务费', 'RH', '2手术编码', '8.4凝血因子类制品费', '9.1检查用一次性医用材料费', '术前预防性抗菌药物给药时间2', '1手术时间', '手术操作名称1', '是否非计划重返手术室病例2', '2切口', '手术部位感染3', '3手术时间', '是否有使用抗菌药物1', '入院日期', '出院诊断', '手术次数1', '血管介入治疗', '4手术编码', '6切口', '输液反应', '3.4麻醉费', '麻醉分级1', '麻醉开始时间3', '6愈合', '切口部位3', '患者入住重症监护室（ICU）情况', '3手术编码', '预防性抗菌药物使用时机2', '入院科别', '是否微创手术1', '药占比%', '5切口', '腔镜手术名称2', '6.1西药费', '切口等级1', '出院科别', '手术操作名称3', '4切口', '出生日期', '2手术名称', '输血反应次数', '感染情况', '3手术名称', '手术操作编码3', '出院日期', '细菌名称2', '是否非计划重返手术室病例1', '血管介入治疗抗菌药物使用天数', '手术预防性使用抗菌药物天数2', '手术结束时间3', '1麻醉方式', '3.1非手术治疗项目费', '择期手术3', '4愈合', '1手术名称', '病案质量', '5级别', '1.2一般治疗操作费', '术后预防性抗菌药物结束时间2', '3级别', '手术次数3', '4手术名称', '手术操作名称2', '国籍', '是否在术后使用预防性抗菌药物2', '7.1中成药费', '8.1血费', '医疗付费方式', '手术持续时间3', '9.2治疗用一次性医用材料费', '本次住院期间有无重返手术室的计划1', '6手术时间', '是否微创手术2', '5手术名称', '自付金额', '离院方式', '6手术名称', '择期手术1', '手术操作编码2', '病理诊断', '细菌名称4', '6手术编码', '输液反应次数', '4麻醉方式', '3.3手术治疗费', '术前住院天数3', '手术部位感染1', '次数', '2麻醉方式', '3切口', '是否临床路径', '婚姻', '2.1病理诊断费', '入院前颅脑损伤昏迷时间', '本次住院期间有无重返手术室的计划2', '麻醉分级3', '手术操作编码1', '麻醉开始时间2', '3.5手术费', '预防性抗菌药物使用时机1', 'NNIS分级2', '3.2临床物理治疗费', '6级别', 'NNIS分级1', '5手术时间', '2手术时间', '术后预防性抗菌药物结束时间1', '手术持续时间2', '1.4其他费用', '是否在术后使用预防性抗菌药物1', '手术结束时间1', '择期手术2', '麻醉方式1', '手术开始时间1', '切口等级2', '切口部位2', '年龄', '4.康复费', '民族', '血型', '术前住院天数1', '5手术编码', '2.2实验室诊断费', '院内感染', '1切口', '籍贯', '愈合1', '住院天数', '4级别', '总费用', '清洁手术预防使用抗菌药物品种数', '1手术编码', '手术预防性使用抗菌药物天数1', '8.3球蛋白类制品费', '腔镜手术名称1', '手术结束时间2', 'NNIS分级3', '2级别', '药物过敏', '5麻醉方式', '2.3影像学诊断费', '麻醉方式2', '4手术时间', '入院后颅脑损伤昏迷时间', '级别2', '8.2白蛋白类制品费', '细菌名称1', '是否药物过敏', '细菌名称3', '8.5细胞因子类制品费', '级别1'}

2019 的变量: {'目的', '愈合2', '断脐后预防性使用抗菌药物给药时间1', '6麻醉方式', '手术开始时间3', '死亡患者尸检', '1愈合', '入院途径', '2.4临床诊断项目费', '清洁手术预防使用抗菌药物总天数', '麻醉结束时间1', '麻醉结束时间2', '术前使用预防性抗菌药物1', '10.其他费', '新生儿出生体重', '6.2抗菌药物费用', '7.2中草药费', '出生地', '抗菌药物使用天数', '1级别', '新生儿入院体重', '5.中医治疗费', '手术持续时间1', '术前住院天数2', '切口部位1', '病室', '性别', '病室.1', '是否有出院31天内再住院计划', '3愈合', '总药品费', '9.3手术用一次性医用材料费', '手术开始时间2', '术前使用预防性抗菌药物2', '入院诊断', '手术次数2', '断脐后预防性使用抗菌药物给药时间2', '麻醉开始时间1', '是否有使用抗菌药物2', '麻醉分级2', '3麻醉方式', '职业', '2愈合', '手术部位感染2', '5愈合', '术前预防性抗菌药物给药时间1', '1.3护理费', '输血反应', '1.1一般医疗服务费', 'RH', '2手术编码', '8.4凝血因子类制品费', '9.1检查用一次性医用材料费', '术前预防性抗菌药物给药时间2', '1手术时间', '手术操作名称1', '是否非计划重返手术室病例2', '7手术编码', '2切口', '3手术时间', '是否有使用抗菌药物1', '入院日期', '7手术时间', '出院诊断', '手术次数1', '血管介入治疗', '4手术编码', '6切口', '输液反应', '3.4麻醉费', '麻醉分级1', '6愈合', '患者入住重症监护室（ICU）情况', '3手术编码', '预防性抗菌药物使用时机2', '入院科别', '是否微创手术1', '药占比%', '5切口', '腔镜手术名称2', '6.1西药费', '切口等级1', '出院科别', '手术操作名称3', '4切口', '出生日期', '2手术名称', '输血反应次数', '感染情况', '3手术名称', '手术操作编码3', '出院日期', '细菌名称2', '是否非计划重返手术室病例1', '血管介入治疗抗菌药物使用天数', '手术预防性使用抗菌药物天数2', '手术结束时间3', '1麻醉方式', '3.1非手术治疗项目费', '4愈合', '1手术名称', '5级别', '病案质量', '7级别', '7切口', '3级别', '1.2一般治疗操作费', '术后预防性抗菌药物结束时间2', '手术次数3', '4手术名称', '手术操作名称2', '国籍', '是否在术后使用预防性抗菌药物2', '7.1中成药费', '8.1血费', '医疗付费方式', '9.2治疗用一次性医用材料费', '本次住院期间有无重返手术室的计划1', '6手术时间', '是否微创手术2', '5手术名称', '自付金额', '离院方式', '6手术名称', '择期手术1', '手术操作编码2', '病理诊断', '细菌名称4', '6手术编码', '输液反应次数', '4麻醉方式', '3.3手术治疗费', '手术部位感染1', '次数', '2麻醉方式', '3切口', '是否临床路径', '婚姻', '2.1病理诊断费', '入院前颅脑损伤昏迷时间', '本次住院期间有无重返手术室的计划2', '手术操作编码1', '麻醉开始时间2', '3.5手术费', '预防性抗菌药物使用时机1', 'NNIS分级2', '3.2临床物理治疗费', '6级别', 'NNIS分级1', '7愈合', '5手术时间', '2手术时间', '术后预防性抗菌药物结束时间1', '7麻醉方式', '手术持续时间2', '1.4其他费用', '是否在术后使用预防性抗菌药物1', '手术结束时间1', '择期手术2', '麻醉方式1', '手术开始时间1', '切口等级2', '切口部位2', '年龄', '4.康复费', '民族', '血型', '术前住院天数1', '5手术编码', '2.2实验室诊断费', '院内感染', '1切口', '籍贯', '愈合1', '住院天数', '4级别', '总费用', '清洁手术预防使用抗菌药物品种数', '1手术编码', '手术预防性使用抗菌药物天数1', '8.3球蛋白类制品费', '腔镜手术名称1', '手术结束时间2', '2级别', '药物过敏', '5麻醉方式', '2.3影像学诊断费', '麻醉方式2', '4手术时间', '入院后颅脑损伤昏迷时间', '级别2', '8.2白蛋白类制品费', '细菌名称1', '是否药物过敏', '细菌名称3', '8.5细胞因子类制品费', '7手术名称', '级别1'}

2020 的变量: {'目的', '断脐后预防性使用抗菌药物给药时间1', '6麻醉方式', '死亡患者尸检', '1愈合', '入院途径', '2.4临床诊断项目费', '清洁手术预防使用抗菌药物总天数', '麻醉结束时间1', '麻醉结束时间2', '术前使用预防性抗菌药物1', '10.其他费', '新生儿出生体重', '6.2抗菌药物费用', '7.2中草药费', '出生地', '抗菌药物使用天数', '1级别', '新生儿入院体重', '5.中医治疗费', '手术持续时间1', '术前住院天数2', '切口部位1', '病室', '性别', '病室.1', '是否有出院31天内再住院计划', '3愈合', '总药品费', '9.3手术用一次性医用材料费', '手术开始时间2', '术前使用预防性抗菌药物2', '入院诊断', '手术次数2', '断脐后预防性使用抗菌药物给药时间2', '麻醉开始时间1', '是否有使用抗菌药物2', '麻醉分级2', '3麻醉方式', '职业', '2愈合', '手术部位感染2', '5愈合', '术前预防性抗菌药物给药时间1', '1.3护理费', '输血反应', '1.1一般医疗服务费', 'RH', '2手术编码', '8.4凝血因子类制品费', '9.1检查用一次性医用材料费', '术前预防性抗菌药物给药时间2', '1手术时间', '手术操作名称1', '是否非计划重返手术室病例2', '7手术编码', '2切口', '3手术时间', '是否有使用抗菌药物1', '入院日期', '7手术时间', '出院诊断', '手术次数1', '血管介入治疗', '4手术编码', '6切口', '输液反应', '3.4麻醉费', '麻醉分级1', '6愈合', '患者入住重症监护室（ICU）情况', '3手术编码', '预防性抗菌药物使用时机2', '入院科别', '是否微创手术1', '药占比%', '5切口', '腔镜手术名称2', '6.1西药费', '切口等级1', '出院科别', '4切口', '出生日期', '2手术名称', '输血反应次数', '感染情况', '3手术名称', '出院日期', '细菌名称2', '是否非计划重返手术室病例1', '血管介入治疗抗菌药物使用天数', '手术预防性使用抗菌药物天数2', '1麻醉方式', '3.1非手术治疗项目费', '4愈合', '1手术名称', '5级别', '病案质量', '7级别', '7切口', '3级别', '1.2一般治疗操作费', '术后预防性抗菌药物结束时间2', '4手术名称', '手术操作名称2', '国籍', '是否在术后使用预防性抗菌药物2', '7.1中成药费', '8.1血费', '医疗付费方式', '9.2治疗用一次性医用材料费', '本次住院期间有无重返手术室的计划1', '6手术时间', '5手术名称', '自付金额', '离院方式', '6手术名称', '择期手术1', '手术操作编码2', '病理诊断', '细菌名称4', '8愈合', '6手术编码', '4麻醉方式', '3.3手术治疗费', '输液反应次数', '手术部位感染1', '次数', '2麻醉方式', '3切口', '是否临床路径', '婚姻', '2.1病理诊断费', '入院前颅脑损伤昏迷时间', '本次住院期间有无重返手术室的计划2', '8手术编码', '手术操作编码1', '麻醉开始时间2', '3.5手术费', '预防性抗菌药物使用时机1', 'NNIS分级2', '3.2临床物理治疗费', '6级别', 'NNIS分级1', '8手术名称', '7愈合', '5手术时间', '2手术时间', '术后预防性抗菌药物结束时间1', '7麻醉方式', '手术持续时间2', '1.4其他费用', '是否在术后使用预防性抗菌药物1', '手术结束时间1', '择期手术2', '麻醉方式1', '手术开始时间1', '8麻醉方式', '切口等级2', '切口部位2', '年龄', '4.康复费', '民族', '血型', '术前住院天数1', '5手术编码', '2.2实验室诊断费', '院内感染', '1切口', '籍贯', '8手术时间', '愈合1', '住院天数', '4级别', '总费用', '清洁手术预防使用抗菌药物品种数', '1手术编码', '手术预防性使用抗菌药物天数1', '8.3球蛋白类制品费', '腔镜手术名称1', '手术结束时间2', '2级别', '8切口', '药物过敏', '5麻醉方式', '2.3影像学诊断费', '麻醉方式2', '4手术时间', '入院后颅脑损伤昏迷时间', '8级别', '级别2', '8.2白蛋白类制品费', '细菌名称1', '是否药物过敏', '细菌名称3', '8.5细胞因子类制品费', '7手术名称', '级别1'}

2021 的变量: {'目的', '断脐后预防性使用抗菌药物给药时间1', '6麻醉方式', '死亡患者尸检', '1愈合', '入院途径', '2.4临床诊断项目费', '清洁手术预防使用抗菌药物总天数', '麻醉结束时间1', '麻醉结束时间2', '术前使用预防性抗菌药物1', '10.其他费', '新生儿出生体重', '6.2抗菌药物费用', '7.2中草药费', '出生地', '抗菌药物使用天数', '1级别', '新生儿入院体重', '5.中医治疗费', '手术持续时间1', '术前住院天数2', '切口部位1', '病室', '性别', '病室.1', '是否有出院31天内再住院计划', '3愈合', '总药品费', '9.3手术用一次性医用材料费', '手术开始时间2', '术前使用预防性抗菌药物2', '入院诊断', '手术次数2', '断脐后预防性使用抗菌药物给药时间2', '麻醉开始时间1', '是否有使用抗菌药物2', '麻醉分级2', '3麻醉方式', '职业', '2愈合', '手术部位感染2', '5愈合', '术前预防性抗菌药物给药时间1', '1.3护理费', '输血反应', '1.1一般医疗服务费', 'RH', '2手术编码', '8.4凝血因子类制品费', '9.1检查用一次性医用材料费', '术前预防性抗菌药物给药时间2', '1手术时间', '手术操作名称1', '是否非计划重返手术室病例2', '7手术编码', '2切口', '3手术时间', '是否有使用抗菌药物1', '入院日期', '7手术时间', '出院诊断', '手术次数1', '血管介入治疗', '4手术编码', '6切口', '输液反应', '3.4麻醉费', '麻醉分级1', '6愈合', '患者入住重症监护室（ICU）情况', '3手术编码', '预防性抗菌药物使用时机2', '入院科别', '是否微创手术1', '药占比%', '5切口', '腔镜手术名称2', '6.1西药费', '切口等级1', '出院科别', '4切口', '出生日期', '2手术名称', '输血反应次数', '感染情况', '3手术名称', '出院日期', '细菌名称2', '是否非计划重返手术室病例1', '血管介入治疗抗菌药物使用天数', '手术预防性使用抗菌药物天数2', '1麻醉方式', '3.1非手术治疗项目费', '4愈合', '1手术名称', '5级别', '病案质量', '7级别', '7切口', '3级别', '1.2一般治疗操作费', '术后预防性抗菌药物结束时间2', '4手术名称', '手术操作名称2', '国籍', '是否在术后使用预防性抗菌药物2', '7.1中成药费', '8.1血费', '医疗付费方式', '9.2治疗用一次性医用材料费', '本次住院期间有无重返手术室的计划1', '6手术时间', '5手术名称', '自付金额', '离院方式', '6手术名称', '择期手术1', '手术操作编码2', '病理诊断', '细菌名称4', '6手术编码', '8愈合', '4麻醉方式', '3.3手术治疗费', '输液反应次数', '手术部位感染1', '次数', '2麻醉方式', '3切口', '是否临床路径', '婚姻', '2.1病理诊断费', '入院前颅脑损伤昏迷时间', '本次住院期间有无重返手术室的计划2', '8手术编码', '手术操作编码1', '麻醉开始时间2', '3.5手术费', '预防性抗菌药物使用时机1', 'NNIS分级2', '3.2临床物理治疗费', '6级别', 'NNIS分级1', '8手术名称', '7愈合', '5手术时间', '2手术时间', '术后预防性抗菌药物结束时间1', '7麻醉方式', '手术持续时间2', '1.4其他费用', '是否在术后使用预防性抗菌药物1', '手术结束时间1', '择期手术2', '麻醉方式1', '手术开始时间1', '8麻醉方式', '切口等级2', '切口部位2', '年龄', '4.康复费', '民族', '血型', '术前住院天数1', '5手术编码', '2.2实验室诊断费', '院内感染', '1切口', '籍贯', '8手术时间', '愈合1', '住院天数', '4级别', '总费用', '清洁手术预防使用抗菌药物品种数', '1手术编码', '手术预防性使用抗菌药物天数1', '8.3球蛋白类制品费', '腔镜手术名称1', '手术结束时间2', '2级别', '8切口', '药物过敏', '5麻醉方式', '2.3影像学诊断费', '麻醉方式2', '4手术时间', '入院后颅脑损伤昏迷时间', '8级别', '级别2', '8.2白蛋白类制品费', '细菌名称1', '是否药物过敏', '细菌名称3', '8.5细胞因子类制品费', '7手术名称', '级别1'}

2022 的变量: {'目的', '断脐后预防性使用抗菌药物给药时间1', '6麻醉方式', '死亡患者尸检', '1愈合', '入院途径', '2.4临床诊断项目费', '清洁手术预防使用抗菌药物总天数', '麻醉结束时间1', '麻醉结束时间2', '术前使用预防性抗菌药物1', '10.其他费', '新生儿出生体重', '6.2抗菌药物费用', '7.2中草药费', '出生地', '抗菌药物使用天数', '1级别', '新生儿入院体重', '5.中医治疗费', '手术持续时间1', '术前住院天数2', '切口部位1', '病室', '性别', '病室.1', '是否有出院31天内再住院计划', '3愈合', '总药品费', '9.3手术用一次性医用材料费', '手术开始时间2', '术前使用预防性抗菌药物2', '入院诊断', '手术次数2', '断脐后预防性使用抗菌药物给药时间2', '麻醉开始时间1', '是否有使用抗菌药物2', '麻醉分级2', '3麻醉方式', '职业', '2愈合', '手术部位感染2', '5愈合', '术前预防性抗菌药物给药时间1', '1.3护理费', '输血反应', '1.1一般医疗服务费', 'RH', '2手术编码', '8.4凝血因子类制品费', '9.1检查用一次性医用材料费', '术前预防性抗菌药物给药时间2', '1手术时间', '手术操作名称1', '是否非计划重返手术室病例2', '7手术编码', '2切口', '3手术时间', '是否有使用抗菌药物1', '入院日期', '7手术时间', '出院诊断', '手术次数1', '血管介入治疗', '4手术编码', '6切口', '输液反应', '3.4麻醉费', '麻醉分级1', '6愈合', '患者入住重症监护室（ICU）情况', '3手术编码', '预防性抗菌药物使用时机2', '入院科别', '是否微创手术1', '药占比%', '5切口', '腔镜手术名称2', '6.1西药费', '切口等级1', '出院科别', '4切口', '出生日期', '2手术名称', '输血反应次数', '感染情况', '3手术名称', '出院日期', '细菌名称2', '是否非计划重返手术室病例1', '血管介入治疗抗菌药物使用天数', '手术预防性使用抗菌药物天数2', '1麻醉方式', '3.1非手术治疗项目费', '4愈合', '1手术名称', '5级别', '病案质量', '7级别', '7切口', '3级别', '1.2一般治疗操作费', '术后预防性抗菌药物结束时间2', '4手术名称', '手术操作名称2', '国籍', '是否在术后使用预防性抗菌药物2', '7.1中成药费', '8.1血费', '医疗付费方式', '9.2治疗用一次性医用材料费', '本次住院期间有无重返手术室的计划1', '6手术时间', '5手术名称', '自付金额', '离院方式', '6手术名称', '择期手术1', '手术操作编码2', '病理诊断', '细菌名称4', '6手术编码', '8愈合', '4麻醉方式', '3.3手术治疗费', '输液反应次数', '手术部位感染1', '次数', '2麻醉方式', '3切口', '是否临床路径', '婚姻', '2.1病理诊断费', '入院前颅脑损伤昏迷时间', '本次住院期间有无重返手术室的计划2', '8手术编码', '手术操作编码1', '麻醉开始时间2', '3.5手术费', '预防性抗菌药物使用时机1', 'NNIS分级2', '3.2临床物理治疗费', '6级别', 'NNIS分级1', '8手术名称', '7愈合', '5手术时间', '2手术时间', '术后预防性抗菌药物结束时间1', '7麻醉方式', '手术持续时间2', '1.4其他费用', '是否在术后使用预防性抗菌药物1', '手术结束时间1', '择期手术2', '麻醉方式1', '手术开始时间1', '8麻醉方式', '切口等级2', '切口部位2', '年龄', '4.康复费', '民族', '血型', '术前住院天数1', '5手术编码', '2.2实验室诊断费', '院内感染', '1切口', '籍贯', '8手术时间', '愈合1', '住院天数', '4级别', '总费用', '清洁手术预防使用抗菌药物品种数', '1手术编码', '手术预防性使用抗菌药物天数1', '8.3球蛋白类制品费', '腔镜手术名称1', '手术结束时间2', '2级别', '8切口', '药物过敏', '5麻醉方式', '2.3影像学诊断费', '麻醉方式2', '4手术时间', '入院后颅脑损伤昏迷时间', '8级别', '级别2', '8.2白蛋白类制品费', '细菌名称1', '是否药物过敏', '细菌名称3', '8.5细胞因子类制品费', '7手术名称', '级别1'}

2023 的变量: {'目的', '断脐后预防性使用抗菌药物给药时间1', '6麻醉方式', '死亡患者尸检', '1愈合', '入院途径', '2.4临床诊断项目费', '清洁手术预防使用抗菌药物总天数', '麻醉结束时间1', '麻醉结束时间2', '术前使用预防性抗菌药物1', '10.其他费', '新生儿出生体重', '6.2抗菌药物费用', '7.2中草药费', '出生地', '抗菌药物使用天数', '1级别', '新生儿入院体重', '5.中医治疗费', '手术持续时间1', '术前住院天数2', '切口部位1', '病室', '性别', '病室.1', '是否有出院31天内再住院计划', '3愈合', '总药品费', '9.3手术用一次性医用材料费', '手术开始时间2', '术前使用预防性抗菌药物2', '入院诊断', '手术次数2', '断脐后预防性使用抗菌药物给药时间2', '麻醉开始时间1', '是否有使用抗菌药物2', '麻醉分级2', '3麻醉方式', '职业', '2愈合', '手术部位感染2', '5愈合', '术前预防性抗菌药物给药时间1', '1.3护理费', '输血反应', '1.1一般医疗服务费', 'RH', '2手术编码', '8.4凝血因子类制品费', '9.1检查用一次性医用材料费', '术前预防性抗菌药物给药时间2', '1手术时间', '手术操作名称1', '是否非计划重返手术室病例2', '7手术编码', '2切口', '3手术时间', '是否有使用抗菌药物1', '入院日期', '7手术时间', '出院诊断', '手术次数1', '血管介入治疗', '4手术编码', '6切口', '输液反应', '3.4麻醉费', '麻醉分级1', '6愈合', '患者入住重症监护室（ICU）情况', '3手术编码', '预防性抗菌药物使用时机2', '入院科别', '是否微创手术1', '药占比%', '5切口', '腔镜手术名称2', '6.1西药费', '切口等级1', '出院科别', '4切口', '出生日期', '2手术名称', '输血反应次数', '感染情况', '3手术名称', '出院日期', '细菌名称2', '4麻醉医师', '血管介入治疗抗菌药物使用天数', '是否非计划重返手术室病例1', '手术预防性使用抗菌药物天数2', '1麻醉方式', '3.1非手术治疗项目费', '4愈合', '1手术名称', '5级别', '病案质量', '7级别', '7切口', '3级别', '1.2一般治疗操作费', '术后预防性抗菌药物结束时间2', '4手术名称', '手术操作名称2', '国籍', '是否在术后使用预防性抗菌药物2', '7.1中成药费', '8.1血费', '医疗付费方式', '9.2治疗用一次性医用材料费', '本次住院期间有无重返手术室的计划1', '6手术时间', '5手术名称', '自付金额', '离院方式', '6手术名称', '择期手术1', '手术操作编码2', '病理诊断', '细菌名称4', '6手术编码', '8愈合', '输液反应次数', '3.3手术治疗费', '手术部位感染1', '次数', '2麻醉方式', '3切口', '是否临床路径', '婚姻', '2.1病理诊断费', '入院前颅脑损伤昏迷时间', '本次住院期间有无重返手术室的计划2', '8手术编码', '手术操作编码1', '麻醉开始时间2', '3.5手术费', '预防性抗菌药物使用时机1', 'NNIS分级2', '3.2临床物理治疗费', '6级别', 'NNIS分级1', '8手术名称', '7愈合', '5手术时间', '2手术时间', '术后预防性抗菌药物结束时间1', '7麻醉方式', '手术持续时间2', '1.4其他费用', '是否在术后使用预防性抗菌药物1', '手术结束时间1', '择期手术2', '麻醉方式1', '手术开始时间1', '8麻醉方式', '切口等级2', '切口部位2', '年龄', '4.康复费', '民族', '血型', '术前住院天数1', '5手术编码', '2.2实验室诊断费', '院内感染', '1切口', '籍贯', '8手术时间', '愈合1', '住院天数', '4级别', '总费用', '清洁手术预防使用抗菌药物品种数', '1手术编码', '手术预防性使用抗菌药物天数1', '8.3球蛋白类制品费', '腔镜手术名称1', '手术结束时间2', '2级别', '8切口', '药物过敏', '5麻醉方式', '2.3影像学诊断费', '麻醉方式2', '4手术时间', '入院后颅脑损伤昏迷时间', '8级别', '级别2', '8.2白蛋白类制品费', '细菌名称1', '是否药物过敏', '细菌名称3', '8.5细胞因子类制品费', '7手术名称', '级别1'}</code></pre>
</div>
</div>
<p>然后剔除不一致的变量数据，同时创建一个新变量<code>year</code>，用sheet的年份对其进行填充，再按变量名对应合并6张表格的数据称为一张总表，命名为<code>merge-sheet.xlsx</code>输出到你需要存放数据的文件夹中。</p>
<p>变量还是太多了，那接下来对变量进行筛选，首先我们可以对所有键值为空的变量进行剔除，或者根据实际的研究需要，剔除一部分键值全部为null的变量。</p>
<p>这里我选择对键值全部为null或0的变量进行剔除。</p>
<p>第一次尝试的时候，打开表后进行查看，发现变量顺序很乱，没有按照原始顺序进行排列，处理办法则是在前面的变量筛选部分使用<code>DataFrame</code>的<code>loc</code>方法选择列，同时保持列的顺序。</p>
<p>同时为了节省时间，因为在Quarto中运行Python代码很慢，暂时还不知道原因，待以后调试一下。所以最后用一个程序解决上述这些问题，节省时间。</p>
<div id="544375bd" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 导入 Excel 文件</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> <span class="st">"C:/Users/asus/Desktop/test/stata/prepare.xlsx"</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> <span class="st">"C:/Users/asus/Desktop/test/stata/data/merge-data.xlsx"</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>final_output_path <span class="op">=</span> <span class="st">"C:/Users/asus/Desktop/test/stata/data/cleaned-merge-data.xlsx"</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>sheet_names <span class="op">=</span> [<span class="st">"2018"</span>, <span class="st">"2019"</span>, <span class="st">"2020"</span>, <span class="st">"2021"</span>, <span class="st">"2022"</span>, <span class="st">"2023"</span>]</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 读取所有 sheet 的数据</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>sheets_data <span class="op">=</span> {sheet: pd.read_excel(file_path, sheet_name<span class="op">=</span>sheet) <span class="cf">for</span> sheet <span class="kw">in</span> sheet_names}</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 获取每个 sheet 的列名</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>sheets_columns <span class="op">=</span> {sheet: <span class="bu">set</span>(data.columns) <span class="cf">for</span> sheet, data <span class="kw">in</span> sheets_data.items()}</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 找出所有 sheet 的共同变量</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>common_columns <span class="op">=</span> <span class="bu">set</span>.intersection(<span class="op">*</span>sheets_columns.values())</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 保持原始顺序</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>common_columns <span class="op">=</span> <span class="bu">list</span>(common_columns)  </span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 剔除不一致的变量数据，并添加 year 变量</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> sheet, data <span class="kw">in</span> sheets_data.items():</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    sheets_data[sheet] <span class="op">=</span> data[<span class="bu">list</span>(common_columns)]</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    sheets_data[sheet][<span class="st">'year'</span>] <span class="op">=</span> sheet</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 合并所有 sheet 的数据</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>merged_data <span class="op">=</span> pd.concat(sheets_data.values(), ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="co"># 输出合并后的数据到指定路径</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>merged_data.to_excel(output_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 重新导入合并后的数据</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>merged_data <span class="op">=</span> pd.read_excel(output_path)</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="co"># 剔除键值全部为 null 或 0 的变量，同时保持原始变量的顺序</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>non_null_columns <span class="op">=</span> merged_data.dropna(axis<span class="op">=</span><span class="dv">1</span>, how<span class="op">=</span><span class="st">'all'</span>).columns</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>non_zero_columns <span class="op">=</span> merged_data.loc[:, (merged_data <span class="op">!=</span> <span class="dv">0</span>).<span class="bu">any</span>(axis<span class="op">=</span><span class="dv">0</span>)].columns</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>valid_columns <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> merged_data.columns <span class="cf">if</span> col <span class="kw">in</span> non_null_columns <span class="kw">and</span> col <span class="kw">in</span> non_zero_columns]</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>cleaned_data <span class="op">=</span> merged_data.loc[:, valid_columns]</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a><span class="co"># 输出清理后的数据到指定路径</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>cleaned_data.to_excel(final_output_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"清理后的数据已输出到 </span><span class="sc">{</span>final_output_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a><span class="co"># 展示部分数据</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a><span class="co"># 随机抽取10个样本数据</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>sample_data <span class="op">=</span> cleaned_data.sample(n<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a><span class="co"># 打印样本数据</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sample_data)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>清理后的数据已输出到 C:/Users/asus/Desktop/test/stata/data/cleaned-merge-data.xlsx
      目的 断脐后预防性使用抗菌药物给药时间1 6麻醉方式  1愈合 死亡患者尸检 入院途径  2.4临床诊断项目费  \
14170  -               NaN   NaN  NaN    NaN   急诊      1553.0   
20116  -               NaN   NaN  NaN    NaN   门诊      1272.5   
37053  -               NaN   NaN  NaN    NaN   门诊         0.0   
43824  -               NaN   NaN    甲      否   门诊      1106.0   
32348  -               NaN   NaN  NaN    NaN   门诊       398.5   
37403  -               NaN   NaN  NaN    NaN   门诊        29.0   
31026  -               NaN   NaN    甲    NaN   门诊      1814.0   
12348  -               NaN   NaN    乙    NaN   门诊       592.0   
28312  -               NaN   NaN   其他    NaN   门诊      2022.5   
35851  -               NaN   NaN   其他    NaN   门诊      1417.5   

       清洁手术预防使用抗菌药物总天数              麻醉结束时间1 麻醉结束时间2  ...  2.3影像学诊断费 麻醉方式2  \
14170              NaN                  NaN     NaN  ...          0   NaN   
20116              NaN                  NaN     NaN  ...          0   NaN   
37053              NaN                  NaN     NaN  ...          0   NaN   
43824              1.0  2023-07-07 12:05:33     NaN  ...        256   NaN   
32348              NaN                  NaN     NaN  ...          0   NaN   
37403              NaN                  NaN     NaN  ...          0   NaN   
31026              NaN                  NaN     NaN  ...          0   NaN   
12348              NaN                  NaN     NaN  ...          0   NaN   
28312              NaN                  NaN     NaN  ...        640   NaN   
35851              NaN  2022-07-07 16:25:49     NaN  ...          0   NaN   

       4手术时间 入院后颅脑损伤昏迷时间  级别2  细菌名称1 是否药物过敏 细菌名称3  级别1  year  
14170    NaN      -天-时-分  NaN    NaN      无   NaN  NaN  2020  
20116    NaN      -天-时-分  NaN    NaN      无   NaN  NaN  2020  
37053    NaN      -天-时-分  NaN    NaN      无   NaN  NaN  2022  
43824    NaN      -天-时-分  NaN      -      无     -  4.0  2023  
32348    NaN      -天-时-分  NaN    NaN      无   NaN  NaN  2022  
37403    NaN      -天-时-分  NaN    NaN      无   NaN  NaN  2022  
31026    NaN      -天-时-分  NaN    NaN      无   NaN  NaN  2021  
12348    NaN      -天-时-分  NaN    NaN      无   NaN  NaN  2020  
28312    NaN      -天-时-分  NaN    NaN      无   NaN  NaN  2021  
35851    NaN      -天-时-分  NaN      -      无     -  2.0  2022  

[10 rows x 160 columns]</code></pre>
</div>
</div>
</section>
</section>
<section id="筛选变量" class="level2">
<h2 class="anchored" data-anchor-id="筛选变量">筛选变量</h2>
<p>经过上述筛选后的变量依然还有很多，其中不乏无用信息变量或无效信息变量，对变量做进一步筛选。</p>
<p>对样本进行筛选，需要满足在当年收治且出院，满足常规医保使用条件，关键变量含有缺失值的样本。</p>
<p>使用 <code>pandas</code> 进行处理（根据Excel视图挑选的缺失数据的变量或含有较多缺失值的变量）：</p>
<div id="3a28a1f0" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 文件路径</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>input_file <span class="op">=</span> <span class="vs">r"C:\Users\asus\Desktop\test\stata\data\cleaned-merge-data.xlsx"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>output_file <span class="op">=</span> <span class="vs">r"C:\Users\asus\Desktop\test\stata\data\allclean.xlsx"</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 读取 Excel 文件</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_excel(input_file)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 要删除的列列表</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>columns_to_drop <span class="op">=</span> [</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"新生儿出生体重"</span>, <span class="st">"新生儿入院体重"</span>, <span class="st">"国籍"</span>, <span class="st">"籍贯"</span>, <span class="st">"病室"</span>, <span class="st">"病室.1"</span>, <span class="st">"是否有出院31天内再住院计划"</span>,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"病理诊断"</span>, <span class="st">"院内感染"</span>, <span class="st">"药物过敏"</span>, <span class="st">"死亡患者尸检"</span>, <span class="st">"血型"</span>, <span class="st">"RH"</span>,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"1手术编码"</span>, <span class="st">"1手术时间"</span>, <span class="st">"1级别"</span>, <span class="st">"1切口"</span>, <span class="st">"1愈合"</span>, <span class="st">"1麻醉方式"</span>,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"2手术名称"</span>, <span class="st">"2手术编码"</span>, <span class="st">"2手术时间"</span>, <span class="st">"2级别"</span>, <span class="st">"2切口"</span>, <span class="st">"2愈合"</span>, <span class="st">"2麻醉方式"</span>,</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"3手术名称"</span>, <span class="st">"3手术编码"</span>, <span class="st">"3手术时间"</span>, <span class="st">"3级别"</span>, <span class="st">"3切口"</span>, <span class="st">"3愈合"</span>, <span class="st">"3麻醉方式"</span>,</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"4手术名称"</span>, <span class="st">"4手术编码"</span>, <span class="st">"4手术时间"</span>, <span class="st">"4级别"</span>, <span class="st">"4切口"</span>, <span class="st">"4愈合"</span>, <span class="st">"4麻醉方式"</span>,</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"5手术名称"</span>, <span class="st">"5手术编码"</span>, <span class="st">"5手术时间"</span>, <span class="st">"5级别"</span>, <span class="st">"5切口"</span>, <span class="st">"5愈合"</span>, <span class="st">"5麻醉方式"</span>,</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"6手术名称"</span>, <span class="st">"6手术编码"</span>, <span class="st">"6手术时间"</span>, <span class="st">"6级别"</span>, <span class="st">"6切口"</span>, <span class="st">"6愈合"</span>, <span class="st">"6麻醉方式"</span>,</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"7手术名称"</span>, <span class="st">"7手术编码"</span>, <span class="st">"7手术时间"</span>, <span class="st">"7级别"</span>, <span class="st">"7切口"</span>, <span class="st">"7愈合"</span>, <span class="st">"7麻醉方式"</span>,</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"8手术名称"</span>, <span class="st">"8手术编码"</span>, <span class="st">"8手术时间"</span>, <span class="st">"8级别"</span>, <span class="st">"8切口"</span>, <span class="st">"8愈合"</span>, <span class="st">"8麻醉方式"</span>,</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"目的"</span>, <span class="st">"入院前颅脑损伤昏迷时间"</span>, <span class="st">"入院后颅脑损伤昏迷时间"</span>,</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"抗菌药物使用天数"</span>, <span class="st">"清洁手术预防使用抗菌药物品种数"</span>, <span class="st">"是否临床路径"</span>, <span class="st">"清洁手术预防使用抗菌药物总天数"</span>,</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"患者入住重症监护室（ICU）情况"</span>, <span class="st">"感染情况"</span>, <span class="st">"输血反应"</span>, <span class="st">"输血反应次数"</span>, <span class="st">"输液反应"</span>, <span class="st">"输液反应次数"</span>,</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"细菌名称1"</span>, <span class="st">"细菌名称2"</span>, <span class="st">"细菌名称3"</span>, <span class="st">"细菌名称4"</span>, <span class="st">"血管介入治疗"</span>, <span class="st">"血管介入治疗抗菌药物使用天数"</span>,</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"手术次数1"</span>, <span class="st">"手术操作名称1"</span>, <span class="st">"手术操作编码1"</span>, <span class="st">"手术开始时间1"</span>, <span class="st">"手术结束时间1"</span>, <span class="st">"择期手术1"</span>,</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"麻醉开始时间1"</span>, <span class="st">"麻醉结束时间1"</span>, <span class="st">"麻醉方式1"</span>, <span class="st">"麻醉分级1"</span>, <span class="st">"切口部位1"</span>, <span class="st">"切口等级1"</span>, <span class="st">"NNIS分级1"</span>,</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"手术部位感染1"</span>, <span class="st">"术前住院天数1"</span>, <span class="st">"手术持续时间1"</span>, <span class="st">"是否非计划重返手术室病例1"</span>, <span class="st">"术前使用预防性抗菌药物1"</span>,</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"术前预防性抗菌药物给药时间1"</span>, <span class="st">"是否在术后使用预防性抗菌药物1"</span>, <span class="st">"术后预防性抗菌药物结束时间1"</span>,</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"手术预防性使用抗菌药物天数1"</span>, <span class="st">"是否有使用抗菌药物1"</span>, <span class="st">"预防性抗菌药物使用时机1"</span>,</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">"断脐后预防性使用抗菌药物给药时间1"</span>, <span class="st">"本次住院期间有无重返手术室的计划1"</span>, <span class="st">"腔镜手术名称1"</span>, <span class="st">"级别1"</span>, <span class="st">"愈合1"</span>,</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">"是否微创手术1"</span>, <span class="st">"手术次数2"</span>, <span class="st">"手术操作名称2"</span>, <span class="st">"手术操作编码2"</span>, <span class="st">"手术开始时间2"</span>, <span class="st">"手术结束时间2"</span>,</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"择期手术2"</span>, <span class="st">"麻醉开始时间2"</span>, <span class="st">"麻醉结束时间2"</span>, <span class="st">"麻醉方式2"</span>, <span class="st">"麻醉分级2"</span>, <span class="st">"切口部位2"</span>, <span class="st">"切口等级2"</span>,</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">"NNIS分级2"</span>, <span class="st">"手术部位感染2"</span>, <span class="st">"术前住院天数2"</span>, <span class="st">"手术持续时间2"</span>, <span class="st">"是否非计划重返手术室病例2"</span>,</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">"术前使用预防性抗菌药物2"</span>, <span class="st">"术前预防性抗菌药物给药时间2"</span>, <span class="st">"是否在术后使用预防性抗菌药物2"</span>,</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">"术后预防性抗菌药物结束时间2"</span>, <span class="st">"手术预防性使用抗菌药物天数2"</span>, <span class="st">"是否有使用抗菌药物2"</span>,</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">"预防性抗菌药物使用时机2"</span>, <span class="st">"断脐后预防性使用抗菌药物给药时间2"</span>, <span class="st">"本次住院期间有无重返手术室的计划2"</span>,</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">"腔镜手术名称2"</span>, <span class="st">"级别2"</span>, <span class="st">"愈合2"</span>, <span class="st">"是否微创手术2"</span>, <span class="st">"手术次数3"</span>, <span class="st">"手术操作名称3"</span>, <span class="st">"手术操作编码3"</span>, <span class="st">"手术开始时间3"</span>,</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">"手术结束时间3"</span>, <span class="st">"择期手术3"</span>, <span class="st">"麻醉开始时间3"</span>, <span class="st">"麻醉结束时间3"</span>, <span class="st">"麻醉方式3"</span>, <span class="st">"麻醉分级3"</span>, <span class="st">"切口部位3"</span>, <span class="st">"切口等级3"</span>,</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">"NNIS分级3"</span>, <span class="st">"手术部位感染3"</span>, <span class="st">"术前住院天数3"</span>, <span class="st">"手术持续时间3"</span>, <span class="st">"4麻醉医师"</span>, <span class="st">"出生地"</span>, <span class="st">"籍贯"</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a><span class="co"># 删除指定的列</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(columns<span class="op">=</span>columns_to_drop, errors<span class="op">=</span><span class="st">'ignore'</span>)</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a><span class="co"># 过滤掉 '公安病区'</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'入院科别'</span> <span class="kw">in</span> df.columns <span class="kw">and</span> <span class="st">'出院科别'</span> <span class="kw">in</span> df.columns:</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[<span class="op">~</span>df[<span class="st">'入院科别'</span>].isin([<span class="st">'公安病区'</span>])]</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[<span class="op">~</span>df[<span class="st">'出院科别'</span>].isin([<span class="st">'公安病区'</span>])]</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a><span class="co"># 打印随机 10 个样本</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"随机 10 个样本："</span>)</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.sample(<span class="dv">10</span>))</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a><span class="co"># 将处理后的 DataFrame 写入新的 Excel 文件</span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a><span class="co"># df.to_excel(output_file, index=False)</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"数据清洗完成，已保存到 {output_file}")</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>随机 10 个样本：
      入院途径  2.4临床诊断项目费   10.其他费  7.2中草药费 性别    总药品费  \
45540   门诊       225.0    28.98      0.0  女   22.17   
27023   门诊      1105.0  9923.46      0.0  男   77.87   
10102   门诊       178.3  3442.00      0.0  女  168.30   
29291   门诊       977.5   511.57      0.0  女  626.99   
18117   门诊       624.0   139.90      0.0  女  526.41   
48037   门诊       264.9  3286.00      0.0  男   88.97   
35602   门诊       201.0   336.92      0.0  男  723.32   
17413   门诊      1278.5   357.29      0.0  女  702.13   
966     门诊         0.0    24.75      0.0  女    0.00   
14589   门诊       147.3  4724.00      0.0  女  196.45   

                                                    入院诊断     职业  1.3护理费  \
45540                       老年核性白内障|H25.100,翼状胬肉|H11.000     农民    25.0   
27023              结肠恶性肿瘤个人史|Z85.006,手术后恶性肿瘤化学治疗|Z51.102     农民    75.0   
10102                       老年性白内障|H25.900,玻璃体混浊|H43.300     农民    50.0   
29291                           结肠息肉|K63.500,胃息肉|K31.703  自由职业者   196.0   
18117  大疱性类天疱疮|L12.000,冠状动脉粥样硬化性心脏病|I25.103,心功能Ⅲ级|I50...     居民    85.0   
48037                                    老年核性白内障|H25.100     农民    50.0   
35602                       节肢动物咬伤|T63.402,过敏性皮炎|L23.901     农民   200.6   
17413                                         腹痛|R10.400     居民   125.0   
966                                      脑外伤后综合征|F07.201      -   156.0   
14589  老年性白内障|H25.900,翼状胬肉|H11.000,玻璃体混浊|H43.300,特指手术...     农民    50.0   

       1.1一般医疗服务费  ...  婚姻  3.5手术费   年龄  民族 2.2实验室诊断费  住院天数       总费用  \
45540        32.0  ...  已婚     0.0  61岁  汉族     372.0     1    716.25   
27023       105.0  ...  已婚     0.0  29岁  汉族     499.0     3  11888.53   
10102        52.0  ...  已婚  1976.0  76岁  汉族     387.0     2   6314.60   
29291       245.0  ...  已婚     0.0  67岁  汉族     589.0     7  11239.16   
18117       294.0  ...  已婚     0.0  92岁  汉族    1095.0     3   3133.31   
48037        32.0  ...  已婚  1976.0  77岁  汉族     381.0     1   6164.87   
35602       140.0  ...  已婚     0.0  56岁  汉族     731.0     4   2475.84   
17413       160.0  ...  已婚     0.0  60岁  汉族     608.0     5   4195.02   
966         414.0  ...  未婚     0.0   8岁  汉族       0.0    13   7004.75   
14589        52.0  ...  已婚  1976.0  78岁  汉族       0.0     2   7166.75   

      2.3影像学诊断费 是否药物过敏  year  
45540         0      无  2023  
27023         0      无  2021  
10102        36      无  2019  
29291         0      无  2021  
18117         0      无  2020  
48037        36      无  2023  
35602         0      无  2022  
17413         0      无  2020  
966           0      无  2018  
14589         0      无  2020  

[10 rows x 39 columns]</code></pre>
</div>
</div>
</section>
<section id="使用-stata-赋值和分析" class="level2">
<h2 class="anchored" data-anchor-id="使用-stata-赋值和分析">使用 Stata 赋值和分析</h2>
<section id="icd-10赋值" class="level3">
<h3 class="anchored" data-anchor-id="icd-10赋值">ICD-10赋值</h3>
<p>因为需要对疾病进行分类与根据诊断信息确定来生成共病信息，根据出院诊断来对疾病进行分类与赋值，这里使用 Stata 来完成。</p>
<div class="sourceCode" id="ICD" style="color"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="ICD-1"><a href="#ICD-1" aria-hidden="true" tabindex="-1"></a>**************</span>
<span id="ICD-2"><a href="#ICD-2" aria-hidden="true" tabindex="-1"></a>* 1. 清理环境并导入数据</span>
<span id="ICD-3"><a href="#ICD-3" aria-hidden="true" tabindex="-1"></a>**************</span>
<span id="ICD-4"><a href="#ICD-4" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> <span class="ot">all</span></span>
<span id="ICD-5"><a href="#ICD-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="ICD-6"><a href="#ICD-6" aria-hidden="true" tabindex="-1"></a>* 读取 Excel 文件，假设第一行为列名</span>
<span id="ICD-7"><a href="#ICD-7" aria-hidden="true" tabindex="-1"></a>import excel <span class="st">"C:\Users</span><span class="ch">\a</span><span class="st">sus\Desktop</span><span class="ch">\t</span><span class="st">est\stata\data</span><span class="ch">\a</span><span class="st">llclean.xlsx"</span>, <span class="co">///</span></span>
<span id="ICD-8"><a href="#ICD-8" aria-hidden="true" tabindex="-1"></a>    firstrow <span class="kw">case</span>(<span class="fu">lower</span>) <span class="kw">clear</span></span>
<span id="ICD-9"><a href="#ICD-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="ICD-10"><a href="#ICD-10" aria-hidden="true" tabindex="-1"></a>* 注意：</span>
<span id="ICD-11"><a href="#ICD-11" aria-hidden="true" tabindex="-1"></a>*  - firstrow 表示将第一行作为变量名</span>
<span id="ICD-12"><a href="#ICD-12" aria-hidden="true" tabindex="-1"></a>*  - <span class="kw">case</span>(<span class="fu">lower</span>) 将变量名转换为小写，避免中文或大小写冲突</span>
<span id="ICD-13"><a href="#ICD-13" aria-hidden="true" tabindex="-1"></a>*  - 如果您的表格存在中文列名，可能需要手动 <span class="kw">rename</span></span>
<span id="ICD-14"><a href="#ICD-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="ICD-15"><a href="#ICD-15" aria-hidden="true" tabindex="-1"></a>************************</span>
<span id="ICD-16"><a href="#ICD-16" aria-hidden="true" tabindex="-1"></a>* 2. 处理、提取与分类: 以“出院诊断”列为例</span>
<span id="ICD-17"><a href="#ICD-17" aria-hidden="true" tabindex="-1"></a>************************</span>
<span id="ICD-18"><a href="#ICD-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="ICD-19"><a href="#ICD-19" aria-hidden="true" tabindex="-1"></a>*------------------</span>
<span id="ICD-20"><a href="#ICD-20" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> disease = 出院诊断</span>
<span id="ICD-21"><a href="#ICD-21" aria-hidden="true" tabindex="-1"></a>*------------------</span>
<span id="ICD-22"><a href="#ICD-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="ICD-23"><a href="#ICD-23" aria-hidden="true" tabindex="-1"></a>* 假设您已经将<span class="st">"出院诊断"</span>重命名为了 <span class="st">"disease"</span></span>
<span id="ICD-24"><a href="#ICD-24" aria-hidden="true" tabindex="-1"></a>* 现在要从 disease 里提取 ICD 编码到 icd10 列。</span>
<span id="ICD-25"><a href="#ICD-25" aria-hidden="true" tabindex="-1"></a>* 如果原数据已包含 icd10 这列，可跳过此步。</span>
<span id="ICD-26"><a href="#ICD-26" aria-hidden="true" tabindex="-1"></a>* 这里只是示例，具体提取逻辑需根据实际字符串格式做 parsing:</span>
<span id="ICD-27"><a href="#ICD-27" aria-hidden="true" tabindex="-1"></a>* 例如： 出院诊断 字符串为 <span class="st">"急性化脓性阑尾炎|K35.902|有,高血压病|I10.x00|有"</span></span>
<span id="ICD-28"><a href="#ICD-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="ICD-29"><a href="#ICD-29" aria-hidden="true" tabindex="-1"></a>*（示例）如果 disease 形如 <span class="st">"XXX|K35.902|有,YYY|I10.x00|有"</span></span>
<span id="ICD-30"><a href="#ICD-30" aria-hidden="true" tabindex="-1"></a>* 可以先把逗号换成某种分隔，然后再拆分，这里仅给示例逻辑</span>
<span id="ICD-31"><a href="#ICD-31" aria-hidden="true" tabindex="-1"></a>* 注意：以下只是思路示例，可能需正则表达式、substr、split 等更复杂处理</span>
<span id="ICD-32"><a href="#ICD-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="ICD-33"><a href="#ICD-33" aria-hidden="true" tabindex="-1"></a><span class="co">// 对disease进行拆分</span></span>
<span id="ICD-34"><a href="#ICD-34" aria-hidden="true" tabindex="-1"></a>* 1. 按 | 分隔 disease 列，生成多个新变量</span>
<span id="ICD-35"><a href="#ICD-35" aria-hidden="true" tabindex="-1"></a><span class="kw">split</span> disease, <span class="kw">parse</span>(<span class="st">"|"</span>) <span class="kw">generate</span>(disease_part)</span>
<span id="ICD-36"><a href="#ICD-36" aria-hidden="true" tabindex="-1"></a> </span>
<span id="ICD-37"><a href="#ICD-37" aria-hidden="true" tabindex="-1"></a><span class="co">// 提取第一个 ICD 编码</span></span>
<span id="ICD-38"><a href="#ICD-38" aria-hidden="true" tabindex="-1"></a>* 2. 提取第二部分（part2）作为 icd10，使用正则表达式剔除多余编码</span>
<span id="ICD-39"><a href="#ICD-39" aria-hidden="true" tabindex="-1"></a>* 保留 disease_part2 的前7个字符作为 icd10，形如 C15.900</span>
<span id="ICD-40"><a href="#ICD-40" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> icd10 = <span class="fu">substr</span>(disease_part2, 1, 7)</span>
<span id="ICD-41"><a href="#ICD-41" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> icd_com = <span class="fu">substr</span>(disease_part4, 1, 7)</span>
<span id="ICD-42"><a href="#ICD-42" aria-hidden="true" tabindex="-1"></a>* 去除前后的空格</span>
<span id="ICD-43"><a href="#ICD-43" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> icd10 = <span class="kw">trim</span>(icd10)</span>
<span id="ICD-44"><a href="#ICD-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="ICD-45"><a href="#ICD-45" aria-hidden="true" tabindex="-1"></a>* 3. 删除所有拆分部分</span>
<span id="ICD-46"><a href="#ICD-46" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> disease_part1-disease_part55</span>
<span id="ICD-47"><a href="#ICD-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="ICD-48"><a href="#ICD-48" aria-hidden="true" tabindex="-1"></a>* 4. 检查结果</span>
<span id="ICD-49"><a href="#ICD-49" aria-hidden="true" tabindex="-1"></a><span class="ot">list</span> disease icd10 <span class="kw">in</span> 1/10</span>
<span id="ICD-50"><a href="#ICD-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="ICD-51"><a href="#ICD-51" aria-hidden="true" tabindex="-1"></a>***************************************</span>
<span id="ICD-52"><a href="#ICD-52" aria-hidden="true" tabindex="-1"></a>* 按 ICD 数量判断是否共病</span>
<span id="ICD-53"><a href="#ICD-53" aria-hidden="true" tabindex="-1"></a>***************************************</span>
<span id="ICD-54"><a href="#ICD-54" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> comorbidity = 0  <span class="co">// 初始值为 0</span></span>
<span id="ICD-55"><a href="#ICD-55" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> comorbidity = 1 <span class="kw">if</span> !<span class="fu">missing</span>(icd10) &amp; !<span class="fu">missing</span>(icd_com) </span>
<span id="ICD-56"><a href="#ICD-56" aria-hidden="true" tabindex="-1"></a><span class="co">// 如果ICD10和ICD_com都不为空，则赋值为1</span></span>
<span id="ICD-57"><a href="#ICD-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="ICD-58"><a href="#ICD-58" aria-hidden="true" tabindex="-1"></a><span class="co">// 查看前10行的数据</span></span>
<span id="ICD-59"><a href="#ICD-59" aria-hidden="true" tabindex="-1"></a><span class="ot">list</span> icd10 icd_com comorbidity <span class="kw">in</span> 1/10</span>
<span id="ICD-60"><a href="#ICD-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="ICD-61"><a href="#ICD-61" aria-hidden="true" tabindex="-1"></a>***************************************</span>
<span id="ICD-62"><a href="#ICD-62" aria-hidden="true" tabindex="-1"></a>* 筛除部分变量</span>
<span id="ICD-63"><a href="#ICD-63" aria-hidden="true" tabindex="-1"></a>***************************************</span>
<span id="ICD-64"><a href="#ICD-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="ICD-65"><a href="#ICD-65" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> 入院日期 入院科别 出院日期 出院科别 出院诊断 disease 离院方式 病案质量</span>
<span id="ICD-66"><a href="#ICD-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="ICD-67"><a href="#ICD-67" aria-hidden="true" tabindex="-1"></a>***************************************</span>
<span id="ICD-68"><a href="#ICD-68" aria-hidden="true" tabindex="-1"></a>* 按 ICD 编码生成截取变量</span>
<span id="ICD-69"><a href="#ICD-69" aria-hidden="true" tabindex="-1"></a>***************************************</span>
<span id="ICD-70"><a href="#ICD-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="ICD-71"><a href="#ICD-71" aria-hidden="true" tabindex="-1"></a>* 如果 icd10 是数值型，转换为字符串型</span>
<span id="ICD-72"><a href="#ICD-72" aria-hidden="true" tabindex="-1"></a><span class="kw">tostring</span> icd10, <span class="kw">replace</span>  </span>
<span id="ICD-73"><a href="#ICD-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="ICD-74"><a href="#ICD-74" aria-hidden="true" tabindex="-1"></a>* 检查并创建 icd_3c 变量</span>
<span id="ICD-75"><a href="#ICD-75" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> icd_3c = <span class="st">""</span>   <span class="co">// 如果 icd_3c 不存在，创建一个空的字符串变量</span></span>
<span id="ICD-76"><a href="#ICD-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="ICD-77"><a href="#ICD-77" aria-hidden="true" tabindex="-1"></a>* 截取 icd10 的前三位并赋值给 icd_3c</span>
<span id="ICD-78"><a href="#ICD-78" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> icd_3c = <span class="fu">substr</span>(icd10, 1, 3)  </span>
<span id="ICD-79"><a href="#ICD-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="ICD-80"><a href="#ICD-80" aria-hidden="true" tabindex="-1"></a>* 如果 icd_3c 是数值型，转换为字符串型</span>
<span id="ICD-81"><a href="#ICD-81" aria-hidden="true" tabindex="-1"></a><span class="kw">tostring</span> icd_3c, <span class="kw">replace</span> </span>
<span id="ICD-82"><a href="#ICD-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="ICD-83"><a href="#ICD-83" aria-hidden="true" tabindex="-1"></a>* 创建 icd_str1 变量</span>
<span id="ICD-84"><a href="#ICD-84" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> icd_str1 = <span class="st">""</span></span>
<span id="ICD-85"><a href="#ICD-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="ICD-86"><a href="#ICD-86" aria-hidden="true" tabindex="-1"></a>* icd_str1: ICD 编码首位</span>
<span id="ICD-87"><a href="#ICD-87" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> icd_str1 = <span class="fu">substr</span>(icd10,1,1)</span>
<span id="ICD-88"><a href="#ICD-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="ICD-89"><a href="#ICD-89" aria-hidden="true" tabindex="-1"></a>* 如果 icd_str1 是数值型，转换为字符串型</span>
<span id="ICD-90"><a href="#ICD-90" aria-hidden="true" tabindex="-1"></a><span class="kw">tostring</span> icd_str1, <span class="kw">replace</span> </span>
<span id="ICD-91"><a href="#ICD-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="ICD-92"><a href="#ICD-92" aria-hidden="true" tabindex="-1"></a>* 使用 <span class="kw">trim</span>() 来去除空格</span>
<span id="ICD-93"><a href="#ICD-93" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> icd_str1 = <span class="kw">trim</span>(icd_str1)</span>
<span id="ICD-94"><a href="#ICD-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="ICD-95"><a href="#ICD-95" aria-hidden="true" tabindex="-1"></a>* 查看 icd_str1 的数据类型</span>
<span id="ICD-96"><a href="#ICD-96" aria-hidden="true" tabindex="-1"></a><span class="kw">describe</span> icd_str1</span>
<span id="ICD-97"><a href="#ICD-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="ICD-98"><a href="#ICD-98" aria-hidden="true" tabindex="-1"></a>* 查看是否有空值或特殊字符</span>
<span id="ICD-99"><a href="#ICD-99" aria-hidden="true" tabindex="-1"></a>* <span class="ot">list</span> icd_str1 <span class="kw">if</span> <span class="fu">missing</span>(icd_str1)</span>
<span id="ICD-100"><a href="#ICD-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="ICD-101"><a href="#ICD-101" aria-hidden="true" tabindex="-1"></a>************************</span>
<span id="ICD-102"><a href="#ICD-102" aria-hidden="true" tabindex="-1"></a>* 按照ICD编码归为22类</span>
<span id="ICD-103"><a href="#ICD-103" aria-hidden="true" tabindex="-1"></a>************************</span>
<span id="ICD-104"><a href="#ICD-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="ICD-105"><a href="#ICD-105" aria-hidden="true" tabindex="-1"></a>* 创建icd分类变量：icd_chapter</span>
<span id="ICD-106"><a href="#ICD-106" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> icd_chapter = <span class="st">""</span> </span>
<span id="ICD-107"><a href="#ICD-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="ICD-108"><a href="#ICD-108" aria-hidden="true" tabindex="-1"></a>* 字符转换为数值</span>
<span id="ICD-109"><a href="#ICD-109" aria-hidden="true" tabindex="-1"></a><span class="kw">destring</span> icd_chapter,<span class="kw">replace</span></span>
<span id="ICD-110"><a href="#ICD-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="ICD-111"><a href="#ICD-111" aria-hidden="true" tabindex="-1"></a><span class="co">// 为icd_chapter赋值</span></span>
<span id="ICD-112"><a href="#ICD-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="ICD-113"><a href="#ICD-113" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> icd_chapter=1 <span class="kw">if</span> icd_str1==<span class="st">"A"</span>|icd_str1==<span class="st">"B"</span></span>
<span id="ICD-114"><a href="#ICD-114" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> icd_chapter=2 <span class="kw">if</span> icd_str1==<span class="st">"C"</span>|(icd_3c&gt;=<span class="st">"D00"</span>&amp;icd_3c&lt;=<span class="st">"D48"</span>)</span>
<span id="ICD-115"><a href="#ICD-115" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> icd_chapter=3 <span class="kw">if</span> icd_3c&gt;=<span class="st">"D50"</span>&amp;icd_3c&lt;=<span class="st">"D89"</span></span>
<span id="ICD-116"><a href="#ICD-116" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> icd_chapter=4 <span class="kw">if</span> icd_3c&gt;=<span class="st">"E00"</span>&amp;icd_3c&lt;=<span class="st">"E90"</span></span>
<span id="ICD-117"><a href="#ICD-117" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> icd_chapter=5 <span class="kw">if</span> icd_3c&gt;=<span class="st">"F00"</span>&amp;icd_3c&lt;=<span class="st">"F99"</span></span>
<span id="ICD-118"><a href="#ICD-118" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> icd_chapter=6 <span class="kw">if</span> icd_3c&gt;=<span class="st">"G00"</span>&amp;icd_3c&lt;=<span class="st">"G99"</span></span>
<span id="ICD-119"><a href="#ICD-119" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> icd_chapter=7 <span class="kw">if</span> icd_3c&gt;=<span class="st">"H00"</span>&amp;icd_3c&lt;=<span class="st">"H59"</span></span>
<span id="ICD-120"><a href="#ICD-120" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> icd_chapter=8 <span class="kw">if</span> icd_3c&gt;=<span class="st">"H60"</span>&amp;icd_3c&lt;=<span class="st">"H99"</span></span>
<span id="ICD-121"><a href="#ICD-121" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> icd_chapter=9 <span class="kw">if</span> icd_str1==<span class="st">"I"</span></span>
<span id="ICD-122"><a href="#ICD-122" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> icd_chapter=10 <span class="kw">if</span> icd_str1==<span class="st">"J"</span></span>
<span id="ICD-123"><a href="#ICD-123" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> icd_chapter=11 <span class="kw">if</span> icd_str1==<span class="st">"K"</span></span>
<span id="ICD-124"><a href="#ICD-124" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> icd_chapter=12 <span class="kw">if</span> icd_str1==<span class="st">"L"</span></span>
<span id="ICD-125"><a href="#ICD-125" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> icd_chapter=13 <span class="kw">if</span> icd_str1==<span class="st">"M"</span></span>
<span id="ICD-126"><a href="#ICD-126" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> icd_chapter=14 <span class="kw">if</span> icd_str1==<span class="st">"N"</span></span>
<span id="ICD-127"><a href="#ICD-127" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> icd_chapter=15 <span class="kw">if</span> icd_str1==<span class="st">"O"</span></span>
<span id="ICD-128"><a href="#ICD-128" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> icd_chapter=16 <span class="kw">if</span> icd_str1==<span class="st">"P"</span></span>
<span id="ICD-129"><a href="#ICD-129" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> icd_chapter=17 <span class="kw">if</span> icd_str1==<span class="st">"Q"</span></span>
<span id="ICD-130"><a href="#ICD-130" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> icd_chapter=18 <span class="kw">if</span> icd_str1==<span class="st">"R"</span></span>
<span id="ICD-131"><a href="#ICD-131" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> icd_chapter=19 <span class="kw">if</span> icd_str1==<span class="st">"S"</span>| icd_str1==<span class="st">"T"</span></span>
<span id="ICD-132"><a href="#ICD-132" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> icd_chapter=20 <span class="kw">if</span> icd_str1==<span class="st">"V"</span>| icd_str1==<span class="st">"Y"</span></span>
<span id="ICD-133"><a href="#ICD-133" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> icd_chapter=21 <span class="kw">if</span> icd_str1==<span class="st">"Z"</span></span>
<span id="ICD-134"><a href="#ICD-134" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> icd_chapter=22 <span class="kw">if</span> icd_str1==<span class="st">"U"</span></span>
<span id="ICD-135"><a href="#ICD-135" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> icd_chapter=20 <span class="kw">if</span> icd_str1==<span class="st">"V"</span>| icd_str1==<span class="st">"Y"</span>|icd_str1==<span class="st">"X"</span>|icd_str1==<span class="st">"W"</span></span>
<span id="ICD-136"><a href="#ICD-136" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> icd_chapter=21 <span class="kw">if</span> icd_str1==<span class="st">"Z"</span>| <span class="fu">substr</span>(<span class="kw">trim</span>(icd10),1,2)==<span class="st">"WW"</span></span>
<span id="ICD-137"><a href="#ICD-137" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> icd_chapter=22 <span class="kw">if</span> icd_str1==<span class="st">"U"</span></span>
<span id="ICD-138"><a href="#ICD-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="ICD-139"><a href="#ICD-139" aria-hidden="true" tabindex="-1"></a>***************************************</span>
<span id="ICD-140"><a href="#ICD-140" aria-hidden="true" tabindex="-1"></a>* 检查分类缺失</span>
<span id="ICD-141"><a href="#ICD-141" aria-hidden="true" tabindex="-1"></a>***************************************</span>
<span id="ICD-142"><a href="#ICD-142" aria-hidden="true" tabindex="-1"></a><span class="kw">tab</span> icd_3c <span class="kw">if</span> icd_chapter==.</span>
<span id="ICD-143"><a href="#ICD-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="ICD-144"><a href="#ICD-144" aria-hidden="true" tabindex="-1"></a>****************************</span>
<span id="ICD-145"><a href="#ICD-145" aria-hidden="true" tabindex="-1"></a>* 3. 导出处理后的数据</span>
<span id="ICD-146"><a href="#ICD-146" aria-hidden="true" tabindex="-1"></a>****************************</span>
<span id="ICD-147"><a href="#ICD-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="ICD-148"><a href="#ICD-148" aria-hidden="true" tabindex="-1"></a>* 导出为 Stata 格式</span>
<span id="ICD-149"><a href="#ICD-149" aria-hidden="true" tabindex="-1"></a><span class="kw">save</span> <span class="st">"C:\Users</span><span class="ch">\a</span><span class="st">sus\Desktop</span><span class="ch">\t</span><span class="st">est\stata\data\ICD-result.dta"</span>, <span class="kw">replace</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="赋值与创建部分变量" class="level3">
<h3 class="anchored" data-anchor-id="赋值与创建部分变量">赋值与创建部分变量</h3>
<div class="sourceCode" id="evaluation" style="color"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="evaluation-1"><a href="#evaluation-1" aria-hidden="true" tabindex="-1"></a><span class="co">// 数据处理</span></span>
<span id="evaluation-2"><a href="#evaluation-2" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span> <span class="ot">all</span></span>
<span id="evaluation-3"><a href="#evaluation-3" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="st">"C:\Users</span><span class="ch">\a</span><span class="st">sus\Desktop</span><span class="ch">\t</span><span class="st">est\stata\data\ICD-result.dta"</span>,<span class="kw">clear</span></span>
<span id="evaluation-4"><a href="#evaluation-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="evaluation-5"><a href="#evaluation-5" aria-hidden="true" tabindex="-1"></a><span class="kw">capture</span> <span class="kw">drop</span> Cost  <span class="co">// 捕获可能发生的错误，如果变量不存在则继续执行</span></span>
<span id="evaluation-6"><a href="#evaluation-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="evaluation-7"><a href="#evaluation-7" aria-hidden="true" tabindex="-1"></a>* 创建 id 变量并赋值</span>
<span id="evaluation-8"><a href="#evaluation-8" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> id = <span class="dt">_n</span></span>
<span id="evaluation-9"><a href="#evaluation-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="evaluation-10"><a href="#evaluation-10" aria-hidden="true" tabindex="-1"></a><span class="kw">sort</span> id <span class="fu">year</span></span>
<span id="evaluation-11"><a href="#evaluation-11" aria-hidden="true" tabindex="-1"></a>xtset id <span class="fu">year</span></span>
<span id="evaluation-12"><a href="#evaluation-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="evaluation-13"><a href="#evaluation-13" aria-hidden="true" tabindex="-1"></a>*- 次均费用，需要查看总费用是否和各项目费用加总一致，此处不一致</span>
<span id="evaluation-14"><a href="#evaluation-14" aria-hidden="true" tabindex="-1"></a>* <span class="kw">gen</span> Cost = 总费用 / 次数 </span>
<span id="evaluation-15"><a href="#evaluation-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="evaluation-16"><a href="#evaluation-16" aria-hidden="true" tabindex="-1"></a>*- 住院天数</span>
<span id="evaluation-17"><a href="#evaluation-17" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> Day = 住院天数</span>
<span id="evaluation-18"><a href="#evaluation-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="evaluation-19"><a href="#evaluation-19" aria-hidden="true" tabindex="-1"></a>*- DIP政策</span>
<span id="evaluation-20"><a href="#evaluation-20" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> DIP = .</span>
<span id="evaluation-21"><a href="#evaluation-21" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> DIP = 0 <span class="kw">if</span> <span class="fu">year</span> == 2018</span>
<span id="evaluation-22"><a href="#evaluation-22" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> DIP = 0 <span class="kw">if</span> <span class="fu">year</span> == 2019</span>
<span id="evaluation-23"><a href="#evaluation-23" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> DIP = 0 <span class="kw">if</span> <span class="fu">year</span> == 2020</span>
<span id="evaluation-24"><a href="#evaluation-24" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> DIP = 0 <span class="kw">if</span> <span class="fu">year</span> == 2021</span>
<span id="evaluation-25"><a href="#evaluation-25" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> DIP = 1 <span class="kw">if</span> <span class="fu">year</span> == 2022</span>
<span id="evaluation-26"><a href="#evaluation-26" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> DIP = 1 <span class="kw">if</span> <span class="fu">year</span> == 2023</span>
<span id="evaluation-27"><a href="#evaluation-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="evaluation-28"><a href="#evaluation-28" aria-hidden="true" tabindex="-1"></a>*- 控制变量序列</span>
<span id="evaluation-29"><a href="#evaluation-29" aria-hidden="true" tabindex="-1"></a>*- 年龄</span>
<span id="evaluation-30"><a href="#evaluation-30" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> Age = 年龄</span>
<span id="evaluation-31"><a href="#evaluation-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="evaluation-32"><a href="#evaluation-32" aria-hidden="true" tabindex="-1"></a>*- 性别（虚拟变量；当受访者性别为女性时，赋值为<span class="st">"0"</span>，否则为<span class="st">"1"</span>）</span>
<span id="evaluation-33"><a href="#evaluation-33" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> Gender = 0 <span class="kw">if</span> 性别 == <span class="st">"女"</span></span>
<span id="evaluation-34"><a href="#evaluation-34" aria-hidden="true" tabindex="-1"></a><span class="kw">recode</span> Gender .= 1</span>
<span id="evaluation-35"><a href="#evaluation-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="evaluation-36"><a href="#evaluation-36" aria-hidden="true" tabindex="-1"></a>*- 婚姻（虚拟变量；当受访者已婚时，赋值为<span class="st">"1"</span>，否则为<span class="st">"0"</span>）</span>
<span id="evaluation-37"><a href="#evaluation-37" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> Marriage = 1 <span class="kw">if</span> 婚姻 == <span class="st">"已婚"</span></span>
<span id="evaluation-38"><a href="#evaluation-38" aria-hidden="true" tabindex="-1"></a><span class="kw">recode</span> Marriage .= 0</span>
<span id="evaluation-39"><a href="#evaluation-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="evaluation-40"><a href="#evaluation-40" aria-hidden="true" tabindex="-1"></a>*- 药物过敏</span>
<span id="evaluation-41"><a href="#evaluation-41" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> Sensitive = 1 <span class="kw">if</span> 是否药物过敏 == <span class="st">"有"</span></span>
<span id="evaluation-42"><a href="#evaluation-42" aria-hidden="true" tabindex="-1"></a><span class="kw">recode</span> Sensitive .= 0</span>
<span id="evaluation-43"><a href="#evaluation-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="evaluation-44"><a href="#evaluation-44" aria-hidden="true" tabindex="-1"></a>*- 是否手术</span>
<span id="evaluation-45"><a href="#evaluation-45" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> Opera = 1 <span class="kw">if</span> 手术费 &gt; 0</span>
<span id="evaluation-46"><a href="#evaluation-46" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> Cmedicine = 0 <span class="kw">if</span> 手术费 == 0</span>
<span id="evaluation-47"><a href="#evaluation-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="evaluation-48"><a href="#evaluation-48" aria-hidden="true" tabindex="-1"></a>*- 职业</span>
<span id="evaluation-49"><a href="#evaluation-49" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> Career = 1 <span class="kw">if</span> <span class="fu">strmatch</span>(职业, <span class="st">"*农*"</span>)</span>
<span id="evaluation-50"><a href="#evaluation-50" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> Career = 2 <span class="kw">if</span> <span class="fu">strmatch</span>(职业, <span class="st">"*职*"</span>)</span>
<span id="evaluation-51"><a href="#evaluation-51" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> Career = 3 <span class="kw">if</span> <span class="fu">strmatch</span>(职业, <span class="st">"*无业*"</span>)</span>
<span id="evaluation-52"><a href="#evaluation-52" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> Career = 4 <span class="kw">if</span> Career == .</span>
<span id="evaluation-53"><a href="#evaluation-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="evaluation-54"><a href="#evaluation-54" aria-hidden="true" tabindex="-1"></a>*- 是否共病</span>
<span id="evaluation-55"><a href="#evaluation-55" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> Comorbidity = 1 <span class="kw">if</span> comorbidity == 1</span>
<span id="evaluation-56"><a href="#evaluation-56" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> Comorbidity = 0 <span class="kw">if</span> comorbidity == 0</span>
<span id="evaluation-57"><a href="#evaluation-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="evaluation-58"><a href="#evaluation-58" aria-hidden="true" tabindex="-1"></a>* 疾病类型按照 ICD-10 划分</span>
<span id="evaluation-59"><a href="#evaluation-59" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> Disease = icd_chapter</span>
<span id="evaluation-60"><a href="#evaluation-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="evaluation-61"><a href="#evaluation-61" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> Insurance = 1 <span class="kw">if</span> <span class="fu">strmatch</span>(医疗付费方式, <span class="st">"*自费*"</span>)</span>
<span id="evaluation-62"><a href="#evaluation-62" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> Insurance = 2 <span class="kw">if</span> <span class="fu">strmatch</span>(医疗付费方式, <span class="st">"*商业*"</span>)</span>
<span id="evaluation-63"><a href="#evaluation-63" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> Insurance = 3 <span class="kw">if</span> <span class="fu">strmatch</span>(医疗付费方式, <span class="st">"*城乡居民*"</span>)</span>
<span id="evaluation-64"><a href="#evaluation-64" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> Insurance = 3 <span class="kw">if</span> <span class="fu">strmatch</span>(医疗付费方式, <span class="st">"*城镇居民*"</span>)</span>
<span id="evaluation-65"><a href="#evaluation-65" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> Insurance = 4 <span class="kw">if</span> <span class="fu">strmatch</span>(医疗付费方式, <span class="st">"*城镇职工*"</span>)</span>
<span id="evaluation-66"><a href="#evaluation-66" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> Insurance = 5 <span class="kw">if</span> <span class="fu">strmatch</span>(医疗付费方式, <span class="st">"*贫困救助*"</span>)</span>
<span id="evaluation-67"><a href="#evaluation-67" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> Insurance = 6 <span class="kw">if</span> <span class="fu">strmatch</span>(医疗付费方式, <span class="st">"*新型农村合作*"</span>)</span>
<span id="evaluation-68"><a href="#evaluation-68" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> Insurance = 7 <span class="kw">if</span> <span class="fu">strmatch</span>(医疗付费方式, <span class="st">"*全公费*"</span>)</span>
<span id="evaluation-69"><a href="#evaluation-69" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> Insurance = 2 <span class="kw">if</span> Insurance == .</span>
<span id="evaluation-70"><a href="#evaluation-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="evaluation-71"><a href="#evaluation-71" aria-hidden="true" tabindex="-1"></a>*- 是否使用中药</span>
<span id="evaluation-72"><a href="#evaluation-72" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> Cmedicine = 1 <span class="kw">if</span> 中成药费 &gt; 0</span>
<span id="evaluation-73"><a href="#evaluation-73" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> Cmedicine = 1 <span class="kw">if</span> 中草药费 &gt; 0</span>
<span id="evaluation-74"><a href="#evaluation-74" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> Cmedicine = 0 <span class="kw">if</span> Cmedicine == .</span>
<span id="evaluation-75"><a href="#evaluation-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="evaluation-76"><a href="#evaluation-76" aria-hidden="true" tabindex="-1"></a>*- 入院途径</span>
<span id="evaluation-77"><a href="#evaluation-77" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> category = 1 <span class="kw">if</span> 入院途径 == <span class="st">"门诊"</span></span>
<span id="evaluation-78"><a href="#evaluation-78" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> category = 0 <span class="kw">if</span> 入院途径 == <span class="st">"急诊"</span></span>
<span id="evaluation-79"><a href="#evaluation-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="evaluation-80"><a href="#evaluation-80" aria-hidden="true" tabindex="-1"></a>*- 自付金额</span>
<span id="evaluation-81"><a href="#evaluation-81" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> SelfCost = 自付金额 / 次数</span>
<span id="evaluation-82"><a href="#evaluation-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="evaluation-83"><a href="#evaluation-83" aria-hidden="true" tabindex="-1"></a>*- 除去空值变量</span>
<span id="evaluation-84"><a href="#evaluation-84" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> 其他费用 病理诊断费 临床物理治疗费 手术治疗费 康复费 中医治疗费 抗菌药物费用 白蛋白类制品费 球蛋白类制品费 凝血因子类制品费 细胞因子类制品费 检查用一次性医用材料费 治疗用一次性医用材料费 手术用一次性医用材料费</span>
<span id="evaluation-85"><a href="#evaluation-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="evaluation-86"><a href="#evaluation-86" aria-hidden="true" tabindex="-1"></a>*- 费用变量数据</span>
<span id="evaluation-87"><a href="#evaluation-87" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> GService = 一般医疗服务费 / 次数</span>
<span id="evaluation-88"><a href="#evaluation-88" aria-hidden="true" tabindex="-1"></a>* <span class="kw">gen</span> GOperate = 一般治疗操作费 / 次数</span>
<span id="evaluation-89"><a href="#evaluation-89" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> GSurgery = 手术费 / 次数</span>
<span id="evaluation-90"><a href="#evaluation-90" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> GNurse = 护理费 / 次数</span>
<span id="evaluation-91"><a href="#evaluation-91" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> GNonoperate = 非手术治疗项目费 / 次数</span>
<span id="evaluation-92"><a href="#evaluation-92" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> GNarcosis = 麻醉费 / 次数</span>
<span id="evaluation-93"><a href="#evaluation-93" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> GDrug = 西药费 / 次数</span>
<span id="evaluation-94"><a href="#evaluation-94" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> GBlood = 血费 / 次数</span>
<span id="evaluation-95"><a href="#evaluation-95" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> Others = 其他费 / 次数</span>
<span id="evaluation-96"><a href="#evaluation-96" aria-hidden="true" tabindex="-1"></a><span class="co">// 计算行总和</span></span>
<span id="evaluation-97"><a href="#evaluation-97" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> temp_total_diagnose = <span class="fu">rowtotal</span>(实验室诊断费 影像学诊断费 临床诊断项目费)</span>
<span id="evaluation-98"><a href="#evaluation-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="evaluation-99"><a href="#evaluation-99" aria-hidden="true" tabindex="-1"></a><span class="co">// 进行除法运算</span></span>
<span id="evaluation-100"><a href="#evaluation-100" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> GDiagnose = temp_total_diagnose / 次数</span>
<span id="evaluation-101"><a href="#evaluation-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="evaluation-102"><a href="#evaluation-102" aria-hidden="true" tabindex="-1"></a><span class="co">// 删除临时变量</span></span>
<span id="evaluation-103"><a href="#evaluation-103" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> temp_total_diagnose</span>
<span id="evaluation-104"><a href="#evaluation-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="evaluation-105"><a href="#evaluation-105" aria-hidden="true" tabindex="-1"></a><span class="co">// 计算行总和</span></span>
<span id="evaluation-106"><a href="#evaluation-106" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> temp_total_cdrug = <span class="fu">rowtotal</span>(中成药费 中草药费)</span>
<span id="evaluation-107"><a href="#evaluation-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="evaluation-108"><a href="#evaluation-108" aria-hidden="true" tabindex="-1"></a><span class="co">// 进行除法运算</span></span>
<span id="evaluation-109"><a href="#evaluation-109" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> GCDrug = temp_total_cdrug / 次数</span>
<span id="evaluation-110"><a href="#evaluation-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="evaluation-111"><a href="#evaluation-111" aria-hidden="true" tabindex="-1"></a><span class="co">// 删除临时变量</span></span>
<span id="evaluation-112"><a href="#evaluation-112" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> temp_total_cdrug</span>
<span id="evaluation-113"><a href="#evaluation-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="evaluation-114"><a href="#evaluation-114" aria-hidden="true" tabindex="-1"></a>*- 次均费用</span>
<span id="evaluation-115"><a href="#evaluation-115" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> Cost = <span class="fu">rowtotal</span>(GService GSurgery GNurse GNonoperate GNarcosis GDrug GBlood GDiagnose GCDrug Others) </span>
<span id="evaluation-116"><a href="#evaluation-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="evaluation-117"><a href="#evaluation-117" aria-hidden="true" tabindex="-1"></a>*- 对变量进行排序</span>
<span id="evaluation-118"><a href="#evaluation-118" aria-hidden="true" tabindex="-1"></a><span class="kw">order</span> id <span class="fu">year</span> Cost SelfCost Day DIP Age Gender Marriage Sensitive Opera Career Disease Comorbidity Insurance Cmedicine category GService GSurgery GNurse GNonoperate GNarcosis GDrug GCDrug GBlood GDiagnose Others</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="数据分析" class="level2">
<h2 class="anchored" data-anchor-id="数据分析">数据分析</h2>
<section id="描述性统计" class="level3">
<h3 class="anchored" data-anchor-id="描述性统计">描述性统计</h3>
<div class="sourceCode" id="descriptive" style="color"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="descriptive-1"><a href="#descriptive-1" aria-hidden="true" tabindex="-1"></a><span class="co">// 描述性统计 保留小数点后两位</span></span>
<span id="descriptive-2"><a href="#descriptive-2" aria-hidden="true" tabindex="-1"></a>estpost <span class="kw">summarize</span> Cost SelfCost Day DIP Age Gender Marriage Sensitive Opera Career Disease Comorbidity Insurance Cmedicine category GService GSurgery GNurse GNonoperate GNarcosis GDrug GCDrug GBlood GDiagnose, <span class="kw">detail</span></span>
<span id="descriptive-3"><a href="#descriptive-3" aria-hidden="true" tabindex="-1"></a>esttab, cells(<span class="st">"count mean(fmt(2)) sd(fmt(2)) min(fmt(2)) p50(fmt(2)) max(fmt(2))"</span>) <span class="kw">noobs</span> <span class="kw">compress</span> <span class="kw">replace</span> <span class="bn">title</span>(Descriptive <span class="kw">statistics</span>)</span>
<span id="descriptive-4"><a href="#descriptive-4" aria-hidden="true" tabindex="-1"></a>esttab <span class="kw">using</span> <span class="st">"C:\Users</span><span class="ch">\a</span><span class="st">sus\Desktop</span><span class="ch">\t</span><span class="st">est\stata\ICD-10\25.02.09</span><span class="ch">\a</span><span class="st">nalysis-result\描述性统计0218.rtf"</span>, cells(<span class="st">"count mean(fmt(2)) sd(fmt(2)) min(fmt(2)) p50(fmt(2)) max(fmt(2))"</span>) <span class="kw">noobs</span> <span class="kw">compress</span> <span class="kw">replace</span> <span class="bn">title</span>(Descriptive <span class="kw">statistics</span>)</span>
<span id="descriptive-5"><a href="#descriptive-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="descriptive-6"><a href="#descriptive-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="descriptive-7"><a href="#descriptive-7" aria-hidden="true" tabindex="-1"></a><span class="co">// 全样本费用指标</span></span>
<span id="descriptive-8"><a href="#descriptive-8" aria-hidden="true" tabindex="-1"></a><span class="kw">tabstat</span> Cost SelfCost Day GService GSurgery GNurse GNonoperate GNarcosis GDrug GCDrug GBlood GDiagnose Others, <span class="fu">s</span>(<span class="kw">mean</span>) <span class="kw">by</span>(<span class="fu">year</span>)</span>
<span id="descriptive-9"><a href="#descriptive-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="descriptive-10"><a href="#descriptive-10" aria-hidden="true" tabindex="-1"></a><span class="co">// 变量指标</span></span>
<span id="descriptive-11"><a href="#descriptive-11" aria-hidden="true" tabindex="-1"></a><span class="kw">tabstat</span> Cost SelfCost Day DIP Age Gender Marriage Sensitive Opera Career Disease Comorbidity Insurance Cmedicine category, <span class="fu">s</span>(<span class="kw">mean</span>) <span class="kw">by</span>(<span class="fu">year</span>)</span>
<span id="descriptive-12"><a href="#descriptive-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="descriptive-13"><a href="#descriptive-13" aria-hidden="true" tabindex="-1"></a>* 计算所有年份的均值</span>
<span id="descriptive-14"><a href="#descriptive-14" aria-hidden="true" tabindex="-1"></a><span class="kw">summarize</span> Cost SelfCost Day GService GSurgery GNurse GNonoperate GNarcosis GDrug GCDrug GBlood GDiagnose Others</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="回归分析" class="level3">
<h3 class="anchored" data-anchor-id="回归分析">回归分析</h3>
<p>为了稳健性，对因变量进行缩尾处理。</p>
<div class="sourceCode" id="regression" style="color"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="regression-1"><a href="#regression-1" aria-hidden="true" tabindex="-1"></a>*- 缩尾处理（目的：剔除异常值；剔除的比例根据研究而定）</span>
<span id="regression-2"><a href="#regression-2" aria-hidden="true" tabindex="-1"></a>winsor2 Cost Day Age, <span class="kw">replace</span> cuts(1, 99)</span>
<span id="regression-3"><a href="#regression-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="regression-4"><a href="#regression-4" aria-hidden="true" tabindex="-1"></a><span class="co">// 全局暂元</span></span>
<span id="regression-5"><a href="#regression-5" aria-hidden="true" tabindex="-1"></a><span class="kw">global</span> Control Age Gender Career Marriage category Disease Opera Comorbidity Cmedicine Insurance </span>
<span id="regression-6"><a href="#regression-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="regression-7"><a href="#regression-7" aria-hidden="true" tabindex="-1"></a><span class="co">// 基准模型</span></span>
<span id="regression-8"><a href="#regression-8" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> Cost DIP <span class="ot">$Control</span>, <span class="fu">r</span></span>
<span id="regression-9"><a href="#regression-9" aria-hidden="true" tabindex="-1"></a><span class="kw">est</span> <span class="kw">store</span> m1</span>
<span id="regression-10"><a href="#regression-10" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> SelfCost DIP <span class="ot">$Control</span>, <span class="fu">r</span></span>
<span id="regression-11"><a href="#regression-11" aria-hidden="true" tabindex="-1"></a><span class="kw">est</span> <span class="kw">store</span> m2</span>
<span id="regression-12"><a href="#regression-12" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> Day DIP <span class="ot">$Control</span> Sensitive, <span class="fu">r</span> <span class="co">// Sensitive 只在Day的模型中出现</span></span>
<span id="regression-13"><a href="#regression-13" aria-hidden="true" tabindex="-1"></a><span class="kw">est</span> <span class="kw">store</span> m3</span>
<span id="regression-14"><a href="#regression-14" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> Cost DIP <span class="ot">$Control</span> Day, <span class="fu">r</span></span>
<span id="regression-15"><a href="#regression-15" aria-hidden="true" tabindex="-1"></a><span class="kw">est</span> <span class="kw">store</span> m4</span>
<span id="regression-16"><a href="#regression-16" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> SelfCost DIP <span class="ot">$Control</span> Day, <span class="fu">r</span></span>
<span id="regression-17"><a href="#regression-17" aria-hidden="true" tabindex="-1"></a><span class="kw">est</span> <span class="kw">store</span> m5</span>
<span id="regression-18"><a href="#regression-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="regression-19"><a href="#regression-19" aria-hidden="true" tabindex="-1"></a>* 输出基准模型结果</span>
<span id="regression-20"><a href="#regression-20" aria-hidden="true" tabindex="-1"></a>esttab m1 m2 m3 m4 m5 <span class="kw">using</span> <span class="st">"C:\Users</span><span class="ch">\a</span><span class="st">sus\Desktop</span><span class="ch">\t</span><span class="st">est\stata\ICD-10\25.02.09</span><span class="ch">\a</span><span class="st">nalysis-result0218\基准模型结果.rtf"</span>, <span class="kw">replace</span> b(2) t(2) ar2 <span class="kw">star</span>(* 0.1 ** 0.05 *** 0.01) nogap</span>
<span id="regression-21"><a href="#regression-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="regression-22"><a href="#regression-22" aria-hidden="true" tabindex="-1"></a><span class="co">// 调节效应分析</span></span>
<span id="regression-23"><a href="#regression-23" aria-hidden="true" tabindex="-1"></a><span class="kw">global</span> Control Age Gender Career Marriage Disease Opera Comorbidity Cmedicine Insurance</span>
<span id="regression-24"><a href="#regression-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="regression-25"><a href="#regression-25" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> Cost DIP <span class="ot">$Control</span> Day <span class="kw">if</span> category == 1, <span class="fu">r</span></span>
<span id="regression-26"><a href="#regression-26" aria-hidden="true" tabindex="-1"></a><span class="kw">est</span> <span class="kw">store</span> m1</span>
<span id="regression-27"><a href="#regression-27" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> Cost DIP <span class="ot">$Control</span> Day <span class="kw">if</span> category == 0, <span class="fu">r</span></span>
<span id="regression-28"><a href="#regression-28" aria-hidden="true" tabindex="-1"></a><span class="kw">est</span> <span class="kw">store</span> m2</span>
<span id="regression-29"><a href="#regression-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="regression-30"><a href="#regression-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="regression-31"><a href="#regression-31" aria-hidden="true" tabindex="-1"></a>*- esttab m1 m2 m3 <span class="kw">using</span> </span>
<span id="regression-32"><a href="#regression-32" aria-hidden="true" tabindex="-1"></a>esttab m1 m2 <span class="kw">using</span> <span class="st">"C:\Users</span><span class="ch">\a</span><span class="st">sus\Desktop</span><span class="ch">\t</span><span class="st">est\stata\ICD-10\25.02.09</span><span class="ch">\a</span><span class="st">nalysis-result0218\调节效应结果-cost&amp;dip.rtf"</span>, <span class="kw">replace</span> b(2) t(2) ar2 <span class="kw">star</span>(* 0.1 ** 0.05 *** 0.01) nogap</span>
<span id="regression-33"><a href="#regression-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="regression-34"><a href="#regression-34" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> SelfCost DIP <span class="ot">$Control</span> Day <span class="kw">if</span> category==1, <span class="fu">r</span></span>
<span id="regression-35"><a href="#regression-35" aria-hidden="true" tabindex="-1"></a><span class="kw">est</span> <span class="kw">store</span> m1</span>
<span id="regression-36"><a href="#regression-36" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> SelfCost DIP <span class="ot">$Control</span> Day <span class="kw">if</span> category==0, <span class="fu">r</span></span>
<span id="regression-37"><a href="#regression-37" aria-hidden="true" tabindex="-1"></a><span class="kw">est</span> <span class="kw">store</span> m2</span>
<span id="regression-38"><a href="#regression-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="regression-39"><a href="#regression-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="regression-40"><a href="#regression-40" aria-hidden="true" tabindex="-1"></a>esttab m1 m2 <span class="kw">using</span> <span class="st">"C:\Users</span><span class="ch">\a</span><span class="st">sus\Desktop</span><span class="ch">\t</span><span class="st">est\stata\ICD-10\25.02.09</span><span class="ch">\a</span><span class="st">nalysis-result0218\调节效应结果-self&amp;dip.rtf"</span>, <span class="kw">replace</span> b(2) t(2) ar2 <span class="kw">star</span>(* 0.1 ** 0.05 *** 0.01) nogap</span>
<span id="regression-41"><a href="#regression-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="regression-42"><a href="#regression-42" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> Day DIP <span class="ot">$Control</span> Sensitive <span class="kw">if</span> category==1, <span class="fu">r</span></span>
<span id="regression-43"><a href="#regression-43" aria-hidden="true" tabindex="-1"></a><span class="kw">est</span> <span class="kw">store</span> m1</span>
<span id="regression-44"><a href="#regression-44" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> Day DIP <span class="ot">$Control</span> Sensitive <span class="kw">if</span> category==0, <span class="fu">r</span></span>
<span id="regression-45"><a href="#regression-45" aria-hidden="true" tabindex="-1"></a><span class="kw">est</span> <span class="kw">store</span> m2</span>
<span id="regression-46"><a href="#regression-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="regression-47"><a href="#regression-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="regression-48"><a href="#regression-48" aria-hidden="true" tabindex="-1"></a>esttab m1 m2 <span class="kw">using</span> <span class="st">"C:\Users</span><span class="ch">\a</span><span class="st">sus\Desktop</span><span class="ch">\t</span><span class="st">est\stata\ICD-10\25.02.09</span><span class="ch">\a</span><span class="st">nalysis-result0218\调节效应结果-day&amp;dip.rtf"</span>, <span class="kw">replace</span> b(2) t(2) ar2 <span class="kw">star</span>(* 0.1 ** 0.05 *** 0.01) nogap</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>


<!-- -->

</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "已复制");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "已复制");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("www\.lazyzhou\.cn");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="zhoulvbang/comments" data-repo-id="R_kgDON9RmWA" data-category="General" data-category-id="DIC_kwDON9RmWM4CnLUH" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../Guide/Python/Python-intro.html" class="pagination-link" aria-label="Python introduction">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Python introduction</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../Guide/SAS/SAS-intro.html" class="pagination-link" aria-label="SAS introduction">
        <span class="nav-page-text">SAS introduction</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">源代码</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb9" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "用Python和Stata处理一份卫生费用数据"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="an">number-sections:</span><span class="co"> false</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="an">toc:</span><span class="co"> false</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2025-02-20"</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Simonzhou"</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">#format: </span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">#  html:           # 输出格式为 HTML</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">#    self-contained: true  # 生成独立的 HTML 文件</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">#  pdf:            # 可选：如果需要 PDF 输出</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">#    default</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="an">jupyter:</span><span class="co"> python3</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true      # 在输出中显示代码</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co">  eval: true      # 执行代码</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false  # 隐藏警告信息</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false  # 隐藏消息</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="fu"># 用Python处理卫生费用数据</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>本篇博客用来记录2025年1月到2月帮助学弟处理一份某二级医院2018-2023年的医疗费用，最开始用的Stata，但是越往后，越感觉到Stata的难用，以及AI对这种程序的支持程度极其有限，随改用 <span class="in">`Python + Stata`</span> 来继续完成相关的分析。</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="fu">## 必须配置</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>运行此文档需要电脑上以安装Python，并且下列包已被安装并且能被调用：</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="in">`numpy jupyter-cache pandas openpyxl`</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>你可以使用 <span class="in">`pip`</span> 或 <span class="in">`conda`</span> 进行安装： <span class="in">`pip install jupyter-cache`</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="fu">## 初步认识数据</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>我们可以使用<span class="in">`pandas`</span>包来查看部分原始数据，数据的基本样式如下：</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="in">```{python, cache=true}</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a><span class="in"># 安装并加载必要的包</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a><span class="in">import pandas as pd</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a><span class="in">import numpy as np</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a><span class="in"># 导入 Excel 文件</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a><span class="in">file_path = "C:/Users/asus/Desktop/test/stata/prepare.xlsx"</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a><span class="in">data = pd.read_excel(file_path, sheet_name=0, engine='openpyxl')     </span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a><span class="in"># 数据脱敏，删除地方</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a><span class="in">columns_to_drop = ["籍贯", "出生地"]</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a><span class="in">data = data.drop(columns=columns_to_drop, errors='ignore')  # errors='ignore' 防止列不存在时报错</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a><span class="in"># 随机抽取10个样本数据</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a><span class="in">sample_data = data.sample(n=10, random_state=42)</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a><span class="in"># 打印样本数据</span></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a><span class="in">print(sample_data)</span></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>我们可以看到，该数据的列很多，第一张表中有200列，我们需要对其进行一些筛选。</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a><span class="fu">## 对数据的思考</span></span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>从哪里开始是一个需要思考的问题，对于数据的认识决定了你处理问题的方向和效率。首先，理解数据的来源至关重要，这包括了解数据是如何收集的、收集过程中可能出现的偏差或错误。其次，明确数据的类型与结构也是关键步骤之一，不同类型的数据（如定量数据、定性数据）需要采用不同的分析方法。再者，对数据进行初步探索，比如通过可视化手段观察数据分布特征，或是计算一些基本统计量来了解数据的基本情况，能够帮助你更好地制定数据处理策略。</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>在真正开始处理数据之前，还需要考虑你的目标是什么。是为了回答一个具体的问题，还是为了探索潜在的模式？明确了目标之后，才能有针对性地选择合适的工具和技术。此外，考虑到数据质量的问题，数据清洗是不可跳过的一步，它包括去除异常值、填补缺失值等操作，这对于提高分析结果的准确性非常关键。</span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>最后，保持对数据伦理的关注同样重要，在整个数据分析的过程中，确保遵循相关的隐私保护法规和道德标准，这样才能确保你的工作不仅有效，而且负责任。通过对数据全面而深刻的理解，你可以更加自信地从数据中提取有价值的信息，并为决策提供有力支持。</span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a><span class="fu">### 合并数据</span></span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>这份Excel文件有6张sheet，分别是2018-2023年，首先需要检查这六张sheet中的变量是否一致：</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a><span class="in">```{python,cache=true}</span></span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a><span class="in">import pandas as pd</span></span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a><span class="in"># 导入 Excel 文件</span></span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a><span class="in">file_path = "C:/Users/asus/Desktop/test/stata/prepare.xlsx"</span></span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a><span class="in">sheet_names = ["2018", "2019", "2020", "2021", "2022", "2023"]</span></span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a><span class="in"># 读取所有 sheet 的数据</span></span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a><span class="in">sheets_data = {sheet: pd.read_excel(file_path, sheet_name=sheet) for sheet in sheet_names}</span></span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a><span class="in"># 获取每个 sheet 的列名</span></span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a><span class="in">sheets_columns = {sheet: set(data.columns) for sheet, data in sheets_data.items()}</span></span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a><span class="in"># 找出所有 sheet 的共同变量和不一致的变量</span></span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a><span class="in">common_columns = set.intersection(*sheets_columns.values())</span></span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a><span class="in">all_columns = set.union(*sheets_columns.values())</span></span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a><span class="in">inconsistent_columns = all_columns - common_columns</span></span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a><span class="in"># 打印结果</span></span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a><span class="in">print("一致的变量名:")</span></span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a><span class="in">print(common_columns)</span></span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a><span class="in">print("\n不一致的变量名:")</span></span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a><span class="in">print(inconsistent_columns)</span></span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a><span class="in"># 打印每个 sheet 的变量</span></span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a><span class="in">for sheet, columns in sheets_columns.items():</span></span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a><span class="in">    print(f"\n{sheet} 的变量: {columns}")</span></span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a>然后剔除不一致的变量数据，同时创建一个新变量<span class="in">`year`</span>，用sheet的年份对其进行填充，再按变量名对应合并6张表格的数据称为一张总表，命名为<span class="in">`merge-sheet.xlsx`</span>输出到你需要存放数据的文件夹中。</span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a>变量还是太多了，那接下来对变量进行筛选，首先我们可以对所有键值为空的变量进行剔除，或者根据实际的研究需要，剔除一部分键值全部为null的变量。</span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a>这里我选择对键值全部为null或0的变量进行剔除。</span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a>第一次尝试的时候，打开表后进行查看，发现变量顺序很乱，没有按照原始顺序进行排列，处理办法则是在前面的变量筛选部分使用<span class="in">`DataFrame`</span>的<span class="in">`loc`</span>方法选择列，同时保持列的顺序。</span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a>同时为了节省时间，因为在Quarto中运行Python代码很慢，暂时还不知道原因，待以后调试一下。所以最后用一个程序解决上述这些问题，节省时间。</span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a><span class="in">```{python, cache=true}</span></span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a><span class="in">import pandas as pd</span></span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a><span class="in"># 导入 Excel 文件</span></span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a><span class="in">file_path = "C:/Users/asus/Desktop/test/stata/prepare.xlsx"</span></span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a><span class="in">output_path = "C:/Users/asus/Desktop/test/stata/data/merge-data.xlsx"</span></span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a><span class="in">final_output_path = "C:/Users/asus/Desktop/test/stata/data/cleaned-merge-data.xlsx"</span></span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a><span class="in">sheet_names = ["2018", "2019", "2020", "2021", "2022", "2023"]</span></span>
<span id="cb9-118"><a href="#cb9-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-119"><a href="#cb9-119" aria-hidden="true" tabindex="-1"></a><span class="in"># 读取所有 sheet 的数据</span></span>
<span id="cb9-120"><a href="#cb9-120" aria-hidden="true" tabindex="-1"></a><span class="in">sheets_data = {sheet: pd.read_excel(file_path, sheet_name=sheet) for sheet in sheet_names}</span></span>
<span id="cb9-121"><a href="#cb9-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-122"><a href="#cb9-122" aria-hidden="true" tabindex="-1"></a><span class="in"># 获取每个 sheet 的列名</span></span>
<span id="cb9-123"><a href="#cb9-123" aria-hidden="true" tabindex="-1"></a><span class="in">sheets_columns = {sheet: set(data.columns) for sheet, data in sheets_data.items()}</span></span>
<span id="cb9-124"><a href="#cb9-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-125"><a href="#cb9-125" aria-hidden="true" tabindex="-1"></a><span class="in"># 找出所有 sheet 的共同变量</span></span>
<span id="cb9-126"><a href="#cb9-126" aria-hidden="true" tabindex="-1"></a><span class="in">common_columns = set.intersection(*sheets_columns.values())</span></span>
<span id="cb9-127"><a href="#cb9-127" aria-hidden="true" tabindex="-1"></a><span class="in"># 保持原始顺序</span></span>
<span id="cb9-128"><a href="#cb9-128" aria-hidden="true" tabindex="-1"></a><span class="in">common_columns = list(common_columns)  </span></span>
<span id="cb9-129"><a href="#cb9-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-130"><a href="#cb9-130" aria-hidden="true" tabindex="-1"></a><span class="in"># 剔除不一致的变量数据，并添加 year 变量</span></span>
<span id="cb9-131"><a href="#cb9-131" aria-hidden="true" tabindex="-1"></a><span class="in">for sheet, data in sheets_data.items():</span></span>
<span id="cb9-132"><a href="#cb9-132" aria-hidden="true" tabindex="-1"></a><span class="in">    sheets_data[sheet] = data[list(common_columns)]</span></span>
<span id="cb9-133"><a href="#cb9-133" aria-hidden="true" tabindex="-1"></a><span class="in">    sheets_data[sheet]['year'] = sheet</span></span>
<span id="cb9-134"><a href="#cb9-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-135"><a href="#cb9-135" aria-hidden="true" tabindex="-1"></a><span class="in"># 合并所有 sheet 的数据</span></span>
<span id="cb9-136"><a href="#cb9-136" aria-hidden="true" tabindex="-1"></a><span class="in">merged_data = pd.concat(sheets_data.values(), ignore_index=True)</span></span>
<span id="cb9-137"><a href="#cb9-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-138"><a href="#cb9-138" aria-hidden="true" tabindex="-1"></a><span class="in"># 输出合并后的数据到指定路径</span></span>
<span id="cb9-139"><a href="#cb9-139" aria-hidden="true" tabindex="-1"></a><span class="in">merged_data.to_excel(output_path, index=False)</span></span>
<span id="cb9-140"><a href="#cb9-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-141"><a href="#cb9-141" aria-hidden="true" tabindex="-1"></a><span class="in"># 重新导入合并后的数据</span></span>
<span id="cb9-142"><a href="#cb9-142" aria-hidden="true" tabindex="-1"></a><span class="in">merged_data = pd.read_excel(output_path)</span></span>
<span id="cb9-143"><a href="#cb9-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-144"><a href="#cb9-144" aria-hidden="true" tabindex="-1"></a><span class="in"># 剔除键值全部为 null 或 0 的变量，同时保持原始变量的顺序</span></span>
<span id="cb9-145"><a href="#cb9-145" aria-hidden="true" tabindex="-1"></a><span class="in">non_null_columns = merged_data.dropna(axis=1, how='all').columns</span></span>
<span id="cb9-146"><a href="#cb9-146" aria-hidden="true" tabindex="-1"></a><span class="in">non_zero_columns = merged_data.loc[:, (merged_data != 0).any(axis=0)].columns</span></span>
<span id="cb9-147"><a href="#cb9-147" aria-hidden="true" tabindex="-1"></a><span class="in">valid_columns = [col for col in merged_data.columns if col in non_null_columns and col in non_zero_columns]</span></span>
<span id="cb9-148"><a href="#cb9-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-149"><a href="#cb9-149" aria-hidden="true" tabindex="-1"></a><span class="in">cleaned_data = merged_data.loc[:, valid_columns]</span></span>
<span id="cb9-150"><a href="#cb9-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-151"><a href="#cb9-151" aria-hidden="true" tabindex="-1"></a><span class="in"># 输出清理后的数据到指定路径</span></span>
<span id="cb9-152"><a href="#cb9-152" aria-hidden="true" tabindex="-1"></a><span class="in">cleaned_data.to_excel(final_output_path, index=False)</span></span>
<span id="cb9-153"><a href="#cb9-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-154"><a href="#cb9-154" aria-hidden="true" tabindex="-1"></a><span class="in">print(f"清理后的数据已输出到 {final_output_path}")</span></span>
<span id="cb9-155"><a href="#cb9-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-156"><a href="#cb9-156" aria-hidden="true" tabindex="-1"></a><span class="in"># 展示部分数据</span></span>
<span id="cb9-157"><a href="#cb9-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-158"><a href="#cb9-158" aria-hidden="true" tabindex="-1"></a><span class="in"># 随机抽取10个样本数据</span></span>
<span id="cb9-159"><a href="#cb9-159" aria-hidden="true" tabindex="-1"></a><span class="in">sample_data = cleaned_data.sample(n=10)</span></span>
<span id="cb9-160"><a href="#cb9-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-161"><a href="#cb9-161" aria-hidden="true" tabindex="-1"></a><span class="in"># 打印样本数据</span></span>
<span id="cb9-162"><a href="#cb9-162" aria-hidden="true" tabindex="-1"></a><span class="in">print(sample_data)</span></span>
<span id="cb9-163"><a href="#cb9-163" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-164"><a href="#cb9-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-165"><a href="#cb9-165" aria-hidden="true" tabindex="-1"></a><span class="fu">## 筛选变量</span></span>
<span id="cb9-166"><a href="#cb9-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-167"><a href="#cb9-167" aria-hidden="true" tabindex="-1"></a>经过上述筛选后的变量依然还有很多，其中不乏无用信息变量或无效信息变量，对变量做进一步筛选。</span>
<span id="cb9-168"><a href="#cb9-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-169"><a href="#cb9-169" aria-hidden="true" tabindex="-1"></a>对样本进行筛选，需要满足在当年收治且出院，满足常规医保使用条件，关键变量含有缺失值的样本。</span>
<span id="cb9-170"><a href="#cb9-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-171"><a href="#cb9-171" aria-hidden="true" tabindex="-1"></a>使用 <span class="in">`pandas`</span> 进行处理（根据Excel视图挑选的缺失数据的变量或含有较多缺失值的变量）：</span>
<span id="cb9-172"><a href="#cb9-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-173"><a href="#cb9-173" aria-hidden="true" tabindex="-1"></a><span class="in">```{python, cache = true , eval = FALSE}</span></span>
<span id="cb9-174"><a href="#cb9-174" aria-hidden="true" tabindex="-1"></a><span class="in">import pandas as pd</span></span>
<span id="cb9-175"><a href="#cb9-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-176"><a href="#cb9-176" aria-hidden="true" tabindex="-1"></a><span class="in"># 文件路径</span></span>
<span id="cb9-177"><a href="#cb9-177" aria-hidden="true" tabindex="-1"></a><span class="in">input_file = r"C:\Users\asus\Desktop\test\stata\data\cleaned-merge-data.xlsx"</span></span>
<span id="cb9-178"><a href="#cb9-178" aria-hidden="true" tabindex="-1"></a><span class="in">output_file = r"C:\Users\asus\Desktop\test\stata\data\allclean.xlsx"</span></span>
<span id="cb9-179"><a href="#cb9-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-180"><a href="#cb9-180" aria-hidden="true" tabindex="-1"></a><span class="in"># 读取 Excel 文件</span></span>
<span id="cb9-181"><a href="#cb9-181" aria-hidden="true" tabindex="-1"></a><span class="in">df = pd.read_excel(input_file)</span></span>
<span id="cb9-182"><a href="#cb9-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-183"><a href="#cb9-183" aria-hidden="true" tabindex="-1"></a><span class="in"># 要删除的列列表</span></span>
<span id="cb9-184"><a href="#cb9-184" aria-hidden="true" tabindex="-1"></a><span class="in">columns_to_drop = [</span></span>
<span id="cb9-185"><a href="#cb9-185" aria-hidden="true" tabindex="-1"></a><span class="in">    "新生儿出生体重", "新生儿入院体重", "国籍", "籍贯", "病室", "病室.1", "是否有出院31天内再住院计划",</span></span>
<span id="cb9-186"><a href="#cb9-186" aria-hidden="true" tabindex="-1"></a><span class="in">    "病理诊断", "院内感染", "药物过敏", "死亡患者尸检", "血型", "RH",</span></span>
<span id="cb9-187"><a href="#cb9-187" aria-hidden="true" tabindex="-1"></a><span class="in">    "1手术编码", "1手术时间", "1级别", "1切口", "1愈合", "1麻醉方式",</span></span>
<span id="cb9-188"><a href="#cb9-188" aria-hidden="true" tabindex="-1"></a><span class="in">    "2手术名称", "2手术编码", "2手术时间", "2级别", "2切口", "2愈合", "2麻醉方式",</span></span>
<span id="cb9-189"><a href="#cb9-189" aria-hidden="true" tabindex="-1"></a><span class="in">    "3手术名称", "3手术编码", "3手术时间", "3级别", "3切口", "3愈合", "3麻醉方式",</span></span>
<span id="cb9-190"><a href="#cb9-190" aria-hidden="true" tabindex="-1"></a><span class="in">    "4手术名称", "4手术编码", "4手术时间", "4级别", "4切口", "4愈合", "4麻醉方式",</span></span>
<span id="cb9-191"><a href="#cb9-191" aria-hidden="true" tabindex="-1"></a><span class="in">    "5手术名称", "5手术编码", "5手术时间", "5级别", "5切口", "5愈合", "5麻醉方式",</span></span>
<span id="cb9-192"><a href="#cb9-192" aria-hidden="true" tabindex="-1"></a><span class="in">    "6手术名称", "6手术编码", "6手术时间", "6级别", "6切口", "6愈合", "6麻醉方式",</span></span>
<span id="cb9-193"><a href="#cb9-193" aria-hidden="true" tabindex="-1"></a><span class="in">    "7手术名称", "7手术编码", "7手术时间", "7级别", "7切口", "7愈合", "7麻醉方式",</span></span>
<span id="cb9-194"><a href="#cb9-194" aria-hidden="true" tabindex="-1"></a><span class="in">    "8手术名称", "8手术编码", "8手术时间", "8级别", "8切口", "8愈合", "8麻醉方式",</span></span>
<span id="cb9-195"><a href="#cb9-195" aria-hidden="true" tabindex="-1"></a><span class="in">    "目的", "入院前颅脑损伤昏迷时间", "入院后颅脑损伤昏迷时间",</span></span>
<span id="cb9-196"><a href="#cb9-196" aria-hidden="true" tabindex="-1"></a><span class="in">    "抗菌药物使用天数", "清洁手术预防使用抗菌药物品种数", "是否临床路径", "清洁手术预防使用抗菌药物总天数",</span></span>
<span id="cb9-197"><a href="#cb9-197" aria-hidden="true" tabindex="-1"></a><span class="in">    "患者入住重症监护室（ICU）情况", "感染情况", "输血反应", "输血反应次数", "输液反应", "输液反应次数",</span></span>
<span id="cb9-198"><a href="#cb9-198" aria-hidden="true" tabindex="-1"></a><span class="in">    "细菌名称1", "细菌名称2", "细菌名称3", "细菌名称4", "血管介入治疗", "血管介入治疗抗菌药物使用天数",</span></span>
<span id="cb9-199"><a href="#cb9-199" aria-hidden="true" tabindex="-1"></a><span class="in">    "手术次数1", "手术操作名称1", "手术操作编码1", "手术开始时间1", "手术结束时间1", "择期手术1",</span></span>
<span id="cb9-200"><a href="#cb9-200" aria-hidden="true" tabindex="-1"></a><span class="in">    "麻醉开始时间1", "麻醉结束时间1", "麻醉方式1", "麻醉分级1", "切口部位1", "切口等级1", "NNIS分级1",</span></span>
<span id="cb9-201"><a href="#cb9-201" aria-hidden="true" tabindex="-1"></a><span class="in">    "手术部位感染1", "术前住院天数1", "手术持续时间1", "是否非计划重返手术室病例1", "术前使用预防性抗菌药物1",</span></span>
<span id="cb9-202"><a href="#cb9-202" aria-hidden="true" tabindex="-1"></a><span class="in">    "术前预防性抗菌药物给药时间1", "是否在术后使用预防性抗菌药物1", "术后预防性抗菌药物结束时间1",</span></span>
<span id="cb9-203"><a href="#cb9-203" aria-hidden="true" tabindex="-1"></a><span class="in">    "手术预防性使用抗菌药物天数1", "是否有使用抗菌药物1", "预防性抗菌药物使用时机1",</span></span>
<span id="cb9-204"><a href="#cb9-204" aria-hidden="true" tabindex="-1"></a><span class="in">    "断脐后预防性使用抗菌药物给药时间1", "本次住院期间有无重返手术室的计划1", "腔镜手术名称1", "级别1", "愈合1",</span></span>
<span id="cb9-205"><a href="#cb9-205" aria-hidden="true" tabindex="-1"></a><span class="in">    "是否微创手术1", "手术次数2", "手术操作名称2", "手术操作编码2", "手术开始时间2", "手术结束时间2",</span></span>
<span id="cb9-206"><a href="#cb9-206" aria-hidden="true" tabindex="-1"></a><span class="in">    "择期手术2", "麻醉开始时间2", "麻醉结束时间2", "麻醉方式2", "麻醉分级2", "切口部位2", "切口等级2",</span></span>
<span id="cb9-207"><a href="#cb9-207" aria-hidden="true" tabindex="-1"></a><span class="in">    "NNIS分级2", "手术部位感染2", "术前住院天数2", "手术持续时间2", "是否非计划重返手术室病例2",</span></span>
<span id="cb9-208"><a href="#cb9-208" aria-hidden="true" tabindex="-1"></a><span class="in">    "术前使用预防性抗菌药物2", "术前预防性抗菌药物给药时间2", "是否在术后使用预防性抗菌药物2",</span></span>
<span id="cb9-209"><a href="#cb9-209" aria-hidden="true" tabindex="-1"></a><span class="in">    "术后预防性抗菌药物结束时间2", "手术预防性使用抗菌药物天数2", "是否有使用抗菌药物2",</span></span>
<span id="cb9-210"><a href="#cb9-210" aria-hidden="true" tabindex="-1"></a><span class="in">    "预防性抗菌药物使用时机2", "断脐后预防性使用抗菌药物给药时间2", "本次住院期间有无重返手术室的计划2",</span></span>
<span id="cb9-211"><a href="#cb9-211" aria-hidden="true" tabindex="-1"></a><span class="in">    "腔镜手术名称2", "级别2", "愈合2", "是否微创手术2", "手术次数3", "手术操作名称3", "手术操作编码3", "手术开始时间3",</span></span>
<span id="cb9-212"><a href="#cb9-212" aria-hidden="true" tabindex="-1"></a><span class="in">    "手术结束时间3", "择期手术3", "麻醉开始时间3", "麻醉结束时间3", "麻醉方式3", "麻醉分级3", "切口部位3", "切口等级3",</span></span>
<span id="cb9-213"><a href="#cb9-213" aria-hidden="true" tabindex="-1"></a><span class="in">    "NNIS分级3", "手术部位感染3", "术前住院天数3", "手术持续时间3", "4麻醉医师", "出生地", "籍贯"</span></span>
<span id="cb9-214"><a href="#cb9-214" aria-hidden="true" tabindex="-1"></a><span class="in">]</span></span>
<span id="cb9-215"><a href="#cb9-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-216"><a href="#cb9-216" aria-hidden="true" tabindex="-1"></a><span class="in"># 删除指定的列</span></span>
<span id="cb9-217"><a href="#cb9-217" aria-hidden="true" tabindex="-1"></a><span class="in">df = df.drop(columns=columns_to_drop, errors='ignore')</span></span>
<span id="cb9-218"><a href="#cb9-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-219"><a href="#cb9-219" aria-hidden="true" tabindex="-1"></a><span class="in"># 过滤掉 '公安病区'</span></span>
<span id="cb9-220"><a href="#cb9-220" aria-hidden="true" tabindex="-1"></a><span class="in">if '入院科别' in df.columns and '出院科别' in df.columns:</span></span>
<span id="cb9-221"><a href="#cb9-221" aria-hidden="true" tabindex="-1"></a><span class="in">    df = df[~df['入院科别'].isin(['公安病区'])]</span></span>
<span id="cb9-222"><a href="#cb9-222" aria-hidden="true" tabindex="-1"></a><span class="in">    df = df[~df['出院科别'].isin(['公安病区'])]</span></span>
<span id="cb9-223"><a href="#cb9-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-224"><a href="#cb9-224" aria-hidden="true" tabindex="-1"></a><span class="in"># 打印随机 10 个样本</span></span>
<span id="cb9-225"><a href="#cb9-225" aria-hidden="true" tabindex="-1"></a><span class="in">print("随机 10 个样本：")</span></span>
<span id="cb9-226"><a href="#cb9-226" aria-hidden="true" tabindex="-1"></a><span class="in">print(df.sample(10))</span></span>
<span id="cb9-227"><a href="#cb9-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-228"><a href="#cb9-228" aria-hidden="true" tabindex="-1"></a><span class="in"># 将处理后的 DataFrame 写入新的 Excel 文件</span></span>
<span id="cb9-229"><a href="#cb9-229" aria-hidden="true" tabindex="-1"></a><span class="in"># df.to_excel(output_file, index=False)</span></span>
<span id="cb9-230"><a href="#cb9-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-231"><a href="#cb9-231" aria-hidden="true" tabindex="-1"></a><span class="in"># print(f"数据清洗完成，已保存到 {output_file}")</span></span>
<span id="cb9-232"><a href="#cb9-232" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-233"><a href="#cb9-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-234"><a href="#cb9-234" aria-hidden="true" tabindex="-1"></a><span class="fu">## 使用 Stata 赋值和分析</span></span>
<span id="cb9-235"><a href="#cb9-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-236"><a href="#cb9-236" aria-hidden="true" tabindex="-1"></a><span class="fu">### ICD-10赋值</span></span>
<span id="cb9-237"><a href="#cb9-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-238"><a href="#cb9-238" aria-hidden="true" tabindex="-1"></a>因为需要对疾病进行分类与根据诊断信息确定来生成共病信息，根据出院诊断来对疾病进行分类与赋值，这里使用 Stata 来完成。</span>
<span id="cb9-239"><a href="#cb9-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-240"><a href="#cb9-240" aria-hidden="true" tabindex="-1"></a><span class="in">``` {#ICD .stata style="color"}</span></span>
<span id="cb9-241"><a href="#cb9-241" aria-hidden="true" tabindex="-1"></a><span class="in">**************</span></span>
<span id="cb9-242"><a href="#cb9-242" aria-hidden="true" tabindex="-1"></a><span class="in">* 1. 清理环境并导入数据</span></span>
<span id="cb9-243"><a href="#cb9-243" aria-hidden="true" tabindex="-1"></a><span class="in">**************</span></span>
<span id="cb9-244"><a href="#cb9-244" aria-hidden="true" tabindex="-1"></a><span class="in">clear all</span></span>
<span id="cb9-245"><a href="#cb9-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-246"><a href="#cb9-246" aria-hidden="true" tabindex="-1"></a><span class="in">* 读取 Excel 文件，假设第一行为列名</span></span>
<span id="cb9-247"><a href="#cb9-247" aria-hidden="true" tabindex="-1"></a><span class="in">import excel "C:\Users\asus\Desktop\test\stata\data\allclean.xlsx", ///</span></span>
<span id="cb9-248"><a href="#cb9-248" aria-hidden="true" tabindex="-1"></a><span class="in">    firstrow case(lower) clear</span></span>
<span id="cb9-249"><a href="#cb9-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-250"><a href="#cb9-250" aria-hidden="true" tabindex="-1"></a><span class="in">* 注意：</span></span>
<span id="cb9-251"><a href="#cb9-251" aria-hidden="true" tabindex="-1"></a><span class="in">*  - firstrow 表示将第一行作为变量名</span></span>
<span id="cb9-252"><a href="#cb9-252" aria-hidden="true" tabindex="-1"></a><span class="in">*  - case(lower) 将变量名转换为小写，避免中文或大小写冲突</span></span>
<span id="cb9-253"><a href="#cb9-253" aria-hidden="true" tabindex="-1"></a><span class="in">*  - 如果您的表格存在中文列名，可能需要手动 rename</span></span>
<span id="cb9-254"><a href="#cb9-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-255"><a href="#cb9-255" aria-hidden="true" tabindex="-1"></a><span class="in">************************</span></span>
<span id="cb9-256"><a href="#cb9-256" aria-hidden="true" tabindex="-1"></a><span class="in">* 2. 处理、提取与分类: 以“出院诊断”列为例</span></span>
<span id="cb9-257"><a href="#cb9-257" aria-hidden="true" tabindex="-1"></a><span class="in">************************</span></span>
<span id="cb9-258"><a href="#cb9-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-259"><a href="#cb9-259" aria-hidden="true" tabindex="-1"></a><span class="in">*------------------</span></span>
<span id="cb9-260"><a href="#cb9-260" aria-hidden="true" tabindex="-1"></a><span class="in">gen disease = 出院诊断</span></span>
<span id="cb9-261"><a href="#cb9-261" aria-hidden="true" tabindex="-1"></a><span class="in">*------------------</span></span>
<span id="cb9-262"><a href="#cb9-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-263"><a href="#cb9-263" aria-hidden="true" tabindex="-1"></a><span class="in">* 假设您已经将"出院诊断"重命名为了 "disease"</span></span>
<span id="cb9-264"><a href="#cb9-264" aria-hidden="true" tabindex="-1"></a><span class="in">* 现在要从 disease 里提取 ICD 编码到 icd10 列。</span></span>
<span id="cb9-265"><a href="#cb9-265" aria-hidden="true" tabindex="-1"></a><span class="in">* 如果原数据已包含 icd10 这列，可跳过此步。</span></span>
<span id="cb9-266"><a href="#cb9-266" aria-hidden="true" tabindex="-1"></a><span class="in">* 这里只是示例，具体提取逻辑需根据实际字符串格式做 parsing:</span></span>
<span id="cb9-267"><a href="#cb9-267" aria-hidden="true" tabindex="-1"></a><span class="in">* 例如： 出院诊断 字符串为 "急性化脓性阑尾炎|K35.902|有,高血压病|I10.x00|有"</span></span>
<span id="cb9-268"><a href="#cb9-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-269"><a href="#cb9-269" aria-hidden="true" tabindex="-1"></a><span class="in">*（示例）如果 disease 形如 "XXX|K35.902|有,YYY|I10.x00|有"</span></span>
<span id="cb9-270"><a href="#cb9-270" aria-hidden="true" tabindex="-1"></a><span class="in">* 可以先把逗号换成某种分隔，然后再拆分，这里仅给示例逻辑</span></span>
<span id="cb9-271"><a href="#cb9-271" aria-hidden="true" tabindex="-1"></a><span class="in">* 注意：以下只是思路示例，可能需正则表达式、substr、split 等更复杂处理</span></span>
<span id="cb9-272"><a href="#cb9-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-273"><a href="#cb9-273" aria-hidden="true" tabindex="-1"></a><span class="in">// 对disease进行拆分</span></span>
<span id="cb9-274"><a href="#cb9-274" aria-hidden="true" tabindex="-1"></a><span class="in">* 1. 按 | 分隔 disease 列，生成多个新变量</span></span>
<span id="cb9-275"><a href="#cb9-275" aria-hidden="true" tabindex="-1"></a><span class="in">split disease, parse("|") generate(disease_part)</span></span>
<span id="cb9-276"><a href="#cb9-276" aria-hidden="true" tabindex="-1"></a><span class="in"> </span></span>
<span id="cb9-277"><a href="#cb9-277" aria-hidden="true" tabindex="-1"></a><span class="in">// 提取第一个 ICD 编码</span></span>
<span id="cb9-278"><a href="#cb9-278" aria-hidden="true" tabindex="-1"></a><span class="in">* 2. 提取第二部分（part2）作为 icd10，使用正则表达式剔除多余编码</span></span>
<span id="cb9-279"><a href="#cb9-279" aria-hidden="true" tabindex="-1"></a><span class="in">* 保留 disease_part2 的前7个字符作为 icd10，形如 C15.900</span></span>
<span id="cb9-280"><a href="#cb9-280" aria-hidden="true" tabindex="-1"></a><span class="in">gen icd10 = substr(disease_part2, 1, 7)</span></span>
<span id="cb9-281"><a href="#cb9-281" aria-hidden="true" tabindex="-1"></a><span class="in">gen icd_com = substr(disease_part4, 1, 7)</span></span>
<span id="cb9-282"><a href="#cb9-282" aria-hidden="true" tabindex="-1"></a><span class="in">* 去除前后的空格</span></span>
<span id="cb9-283"><a href="#cb9-283" aria-hidden="true" tabindex="-1"></a><span class="in">replace icd10 = trim(icd10)</span></span>
<span id="cb9-284"><a href="#cb9-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-285"><a href="#cb9-285" aria-hidden="true" tabindex="-1"></a><span class="in">* 3. 删除所有拆分部分</span></span>
<span id="cb9-286"><a href="#cb9-286" aria-hidden="true" tabindex="-1"></a><span class="in">drop disease_part1-disease_part55</span></span>
<span id="cb9-287"><a href="#cb9-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-288"><a href="#cb9-288" aria-hidden="true" tabindex="-1"></a><span class="in">* 4. 检查结果</span></span>
<span id="cb9-289"><a href="#cb9-289" aria-hidden="true" tabindex="-1"></a><span class="in">list disease icd10 in 1/10</span></span>
<span id="cb9-290"><a href="#cb9-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-291"><a href="#cb9-291" aria-hidden="true" tabindex="-1"></a><span class="in">***************************************</span></span>
<span id="cb9-292"><a href="#cb9-292" aria-hidden="true" tabindex="-1"></a><span class="in">* 按 ICD 数量判断是否共病</span></span>
<span id="cb9-293"><a href="#cb9-293" aria-hidden="true" tabindex="-1"></a><span class="in">***************************************</span></span>
<span id="cb9-294"><a href="#cb9-294" aria-hidden="true" tabindex="-1"></a><span class="in">gen comorbidity = 0  // 初始值为 0</span></span>
<span id="cb9-295"><a href="#cb9-295" aria-hidden="true" tabindex="-1"></a><span class="in">replace comorbidity = 1 if !missing(icd10) &amp; !missing(icd_com) </span></span>
<span id="cb9-296"><a href="#cb9-296" aria-hidden="true" tabindex="-1"></a><span class="in">// 如果ICD10和ICD_com都不为空，则赋值为1</span></span>
<span id="cb9-297"><a href="#cb9-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-298"><a href="#cb9-298" aria-hidden="true" tabindex="-1"></a><span class="in">// 查看前10行的数据</span></span>
<span id="cb9-299"><a href="#cb9-299" aria-hidden="true" tabindex="-1"></a><span class="in">list icd10 icd_com comorbidity in 1/10</span></span>
<span id="cb9-300"><a href="#cb9-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-301"><a href="#cb9-301" aria-hidden="true" tabindex="-1"></a><span class="in">***************************************</span></span>
<span id="cb9-302"><a href="#cb9-302" aria-hidden="true" tabindex="-1"></a><span class="in">* 筛除部分变量</span></span>
<span id="cb9-303"><a href="#cb9-303" aria-hidden="true" tabindex="-1"></a><span class="in">***************************************</span></span>
<span id="cb9-304"><a href="#cb9-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-305"><a href="#cb9-305" aria-hidden="true" tabindex="-1"></a><span class="in">drop 入院日期 入院科别 出院日期 出院科别 出院诊断 disease 离院方式 病案质量</span></span>
<span id="cb9-306"><a href="#cb9-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-307"><a href="#cb9-307" aria-hidden="true" tabindex="-1"></a><span class="in">***************************************</span></span>
<span id="cb9-308"><a href="#cb9-308" aria-hidden="true" tabindex="-1"></a><span class="in">* 按 ICD 编码生成截取变量</span></span>
<span id="cb9-309"><a href="#cb9-309" aria-hidden="true" tabindex="-1"></a><span class="in">***************************************</span></span>
<span id="cb9-310"><a href="#cb9-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-311"><a href="#cb9-311" aria-hidden="true" tabindex="-1"></a><span class="in">* 如果 icd10 是数值型，转换为字符串型</span></span>
<span id="cb9-312"><a href="#cb9-312" aria-hidden="true" tabindex="-1"></a><span class="in">tostring icd10, replace  </span></span>
<span id="cb9-313"><a href="#cb9-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-314"><a href="#cb9-314" aria-hidden="true" tabindex="-1"></a><span class="in">* 检查并创建 icd_3c 变量</span></span>
<span id="cb9-315"><a href="#cb9-315" aria-hidden="true" tabindex="-1"></a><span class="in">gen icd_3c = ""   // 如果 icd_3c 不存在，创建一个空的字符串变量</span></span>
<span id="cb9-316"><a href="#cb9-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-317"><a href="#cb9-317" aria-hidden="true" tabindex="-1"></a><span class="in">* 截取 icd10 的前三位并赋值给 icd_3c</span></span>
<span id="cb9-318"><a href="#cb9-318" aria-hidden="true" tabindex="-1"></a><span class="in">replace icd_3c = substr(icd10, 1, 3)  </span></span>
<span id="cb9-319"><a href="#cb9-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-320"><a href="#cb9-320" aria-hidden="true" tabindex="-1"></a><span class="in">* 如果 icd_3c 是数值型，转换为字符串型</span></span>
<span id="cb9-321"><a href="#cb9-321" aria-hidden="true" tabindex="-1"></a><span class="in">tostring icd_3c, replace </span></span>
<span id="cb9-322"><a href="#cb9-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-323"><a href="#cb9-323" aria-hidden="true" tabindex="-1"></a><span class="in">* 创建 icd_str1 变量</span></span>
<span id="cb9-324"><a href="#cb9-324" aria-hidden="true" tabindex="-1"></a><span class="in">gen icd_str1 = ""</span></span>
<span id="cb9-325"><a href="#cb9-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-326"><a href="#cb9-326" aria-hidden="true" tabindex="-1"></a><span class="in">* icd_str1: ICD 编码首位</span></span>
<span id="cb9-327"><a href="#cb9-327" aria-hidden="true" tabindex="-1"></a><span class="in">replace icd_str1 = substr(icd10,1,1)</span></span>
<span id="cb9-328"><a href="#cb9-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-329"><a href="#cb9-329" aria-hidden="true" tabindex="-1"></a><span class="in">* 如果 icd_str1 是数值型，转换为字符串型</span></span>
<span id="cb9-330"><a href="#cb9-330" aria-hidden="true" tabindex="-1"></a><span class="in">tostring icd_str1, replace </span></span>
<span id="cb9-331"><a href="#cb9-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-332"><a href="#cb9-332" aria-hidden="true" tabindex="-1"></a><span class="in">* 使用 trim() 来去除空格</span></span>
<span id="cb9-333"><a href="#cb9-333" aria-hidden="true" tabindex="-1"></a><span class="in">replace icd_str1 = trim(icd_str1)</span></span>
<span id="cb9-334"><a href="#cb9-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-335"><a href="#cb9-335" aria-hidden="true" tabindex="-1"></a><span class="in">* 查看 icd_str1 的数据类型</span></span>
<span id="cb9-336"><a href="#cb9-336" aria-hidden="true" tabindex="-1"></a><span class="in">describe icd_str1</span></span>
<span id="cb9-337"><a href="#cb9-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-338"><a href="#cb9-338" aria-hidden="true" tabindex="-1"></a><span class="in">* 查看是否有空值或特殊字符</span></span>
<span id="cb9-339"><a href="#cb9-339" aria-hidden="true" tabindex="-1"></a><span class="in">* list icd_str1 if missing(icd_str1)</span></span>
<span id="cb9-340"><a href="#cb9-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-341"><a href="#cb9-341" aria-hidden="true" tabindex="-1"></a><span class="in">************************</span></span>
<span id="cb9-342"><a href="#cb9-342" aria-hidden="true" tabindex="-1"></a><span class="in">* 按照ICD编码归为22类</span></span>
<span id="cb9-343"><a href="#cb9-343" aria-hidden="true" tabindex="-1"></a><span class="in">************************</span></span>
<span id="cb9-344"><a href="#cb9-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-345"><a href="#cb9-345" aria-hidden="true" tabindex="-1"></a><span class="in">* 创建icd分类变量：icd_chapter</span></span>
<span id="cb9-346"><a href="#cb9-346" aria-hidden="true" tabindex="-1"></a><span class="in">gen icd_chapter = "" </span></span>
<span id="cb9-347"><a href="#cb9-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-348"><a href="#cb9-348" aria-hidden="true" tabindex="-1"></a><span class="in">* 字符转换为数值</span></span>
<span id="cb9-349"><a href="#cb9-349" aria-hidden="true" tabindex="-1"></a><span class="in">destring icd_chapter,replace</span></span>
<span id="cb9-350"><a href="#cb9-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-351"><a href="#cb9-351" aria-hidden="true" tabindex="-1"></a><span class="in">// 为icd_chapter赋值</span></span>
<span id="cb9-352"><a href="#cb9-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-353"><a href="#cb9-353" aria-hidden="true" tabindex="-1"></a><span class="in">replace icd_chapter=1 if icd_str1=="A"|icd_str1=="B"</span></span>
<span id="cb9-354"><a href="#cb9-354" aria-hidden="true" tabindex="-1"></a><span class="in">replace icd_chapter=2 if icd_str1=="C"|(icd_3c&gt;="D00"&amp;icd_3c&lt;="D48")</span></span>
<span id="cb9-355"><a href="#cb9-355" aria-hidden="true" tabindex="-1"></a><span class="in">replace icd_chapter=3 if icd_3c&gt;="D50"&amp;icd_3c&lt;="D89"</span></span>
<span id="cb9-356"><a href="#cb9-356" aria-hidden="true" tabindex="-1"></a><span class="in">replace icd_chapter=4 if icd_3c&gt;="E00"&amp;icd_3c&lt;="E90"</span></span>
<span id="cb9-357"><a href="#cb9-357" aria-hidden="true" tabindex="-1"></a><span class="in">replace icd_chapter=5 if icd_3c&gt;="F00"&amp;icd_3c&lt;="F99"</span></span>
<span id="cb9-358"><a href="#cb9-358" aria-hidden="true" tabindex="-1"></a><span class="in">replace icd_chapter=6 if icd_3c&gt;="G00"&amp;icd_3c&lt;="G99"</span></span>
<span id="cb9-359"><a href="#cb9-359" aria-hidden="true" tabindex="-1"></a><span class="in">replace icd_chapter=7 if icd_3c&gt;="H00"&amp;icd_3c&lt;="H59"</span></span>
<span id="cb9-360"><a href="#cb9-360" aria-hidden="true" tabindex="-1"></a><span class="in">replace icd_chapter=8 if icd_3c&gt;="H60"&amp;icd_3c&lt;="H99"</span></span>
<span id="cb9-361"><a href="#cb9-361" aria-hidden="true" tabindex="-1"></a><span class="in">replace icd_chapter=9 if icd_str1=="I"</span></span>
<span id="cb9-362"><a href="#cb9-362" aria-hidden="true" tabindex="-1"></a><span class="in">replace icd_chapter=10 if icd_str1=="J"</span></span>
<span id="cb9-363"><a href="#cb9-363" aria-hidden="true" tabindex="-1"></a><span class="in">replace icd_chapter=11 if icd_str1=="K"</span></span>
<span id="cb9-364"><a href="#cb9-364" aria-hidden="true" tabindex="-1"></a><span class="in">replace icd_chapter=12 if icd_str1=="L"</span></span>
<span id="cb9-365"><a href="#cb9-365" aria-hidden="true" tabindex="-1"></a><span class="in">replace icd_chapter=13 if icd_str1=="M"</span></span>
<span id="cb9-366"><a href="#cb9-366" aria-hidden="true" tabindex="-1"></a><span class="in">replace icd_chapter=14 if icd_str1=="N"</span></span>
<span id="cb9-367"><a href="#cb9-367" aria-hidden="true" tabindex="-1"></a><span class="in">replace icd_chapter=15 if icd_str1=="O"</span></span>
<span id="cb9-368"><a href="#cb9-368" aria-hidden="true" tabindex="-1"></a><span class="in">replace icd_chapter=16 if icd_str1=="P"</span></span>
<span id="cb9-369"><a href="#cb9-369" aria-hidden="true" tabindex="-1"></a><span class="in">replace icd_chapter=17 if icd_str1=="Q"</span></span>
<span id="cb9-370"><a href="#cb9-370" aria-hidden="true" tabindex="-1"></a><span class="in">replace icd_chapter=18 if icd_str1=="R"</span></span>
<span id="cb9-371"><a href="#cb9-371" aria-hidden="true" tabindex="-1"></a><span class="in">replace icd_chapter=19 if icd_str1=="S"| icd_str1=="T"</span></span>
<span id="cb9-372"><a href="#cb9-372" aria-hidden="true" tabindex="-1"></a><span class="in">replace icd_chapter=20 if icd_str1=="V"| icd_str1=="Y"</span></span>
<span id="cb9-373"><a href="#cb9-373" aria-hidden="true" tabindex="-1"></a><span class="in">replace icd_chapter=21 if icd_str1=="Z"</span></span>
<span id="cb9-374"><a href="#cb9-374" aria-hidden="true" tabindex="-1"></a><span class="in">replace icd_chapter=22 if icd_str1=="U"</span></span>
<span id="cb9-375"><a href="#cb9-375" aria-hidden="true" tabindex="-1"></a><span class="in">replace icd_chapter=20 if icd_str1=="V"| icd_str1=="Y"|icd_str1=="X"|icd_str1=="W"</span></span>
<span id="cb9-376"><a href="#cb9-376" aria-hidden="true" tabindex="-1"></a><span class="in">replace icd_chapter=21 if icd_str1=="Z"| substr(trim(icd10),1,2)=="WW"</span></span>
<span id="cb9-377"><a href="#cb9-377" aria-hidden="true" tabindex="-1"></a><span class="in">replace icd_chapter=22 if icd_str1=="U"</span></span>
<span id="cb9-378"><a href="#cb9-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-379"><a href="#cb9-379" aria-hidden="true" tabindex="-1"></a><span class="in">***************************************</span></span>
<span id="cb9-380"><a href="#cb9-380" aria-hidden="true" tabindex="-1"></a><span class="in">* 检查分类缺失</span></span>
<span id="cb9-381"><a href="#cb9-381" aria-hidden="true" tabindex="-1"></a><span class="in">***************************************</span></span>
<span id="cb9-382"><a href="#cb9-382" aria-hidden="true" tabindex="-1"></a><span class="in">tab icd_3c if icd_chapter==.</span></span>
<span id="cb9-383"><a href="#cb9-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-384"><a href="#cb9-384" aria-hidden="true" tabindex="-1"></a><span class="in">****************************</span></span>
<span id="cb9-385"><a href="#cb9-385" aria-hidden="true" tabindex="-1"></a><span class="in">* 3. 导出处理后的数据</span></span>
<span id="cb9-386"><a href="#cb9-386" aria-hidden="true" tabindex="-1"></a><span class="in">****************************</span></span>
<span id="cb9-387"><a href="#cb9-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-388"><a href="#cb9-388" aria-hidden="true" tabindex="-1"></a><span class="in">* 导出为 Stata 格式</span></span>
<span id="cb9-389"><a href="#cb9-389" aria-hidden="true" tabindex="-1"></a><span class="in">save "C:\Users\asus\Desktop\test\stata\data\ICD-result.dta", replace</span></span>
<span id="cb9-390"><a href="#cb9-390" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-391"><a href="#cb9-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-392"><a href="#cb9-392" aria-hidden="true" tabindex="-1"></a><span class="fu">### 赋值与创建部分变量</span></span>
<span id="cb9-393"><a href="#cb9-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-394"><a href="#cb9-394" aria-hidden="true" tabindex="-1"></a><span class="in">``` {#evaluation .stata style="color"}</span></span>
<span id="cb9-395"><a href="#cb9-395" aria-hidden="true" tabindex="-1"></a><span class="in">// 数据处理</span></span>
<span id="cb9-396"><a href="#cb9-396" aria-hidden="true" tabindex="-1"></a><span class="in">clear all</span></span>
<span id="cb9-397"><a href="#cb9-397" aria-hidden="true" tabindex="-1"></a><span class="in">use "C:\Users\asus\Desktop\test\stata\data\ICD-result.dta",clear</span></span>
<span id="cb9-398"><a href="#cb9-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-399"><a href="#cb9-399" aria-hidden="true" tabindex="-1"></a><span class="in">capture drop Cost  // 捕获可能发生的错误，如果变量不存在则继续执行</span></span>
<span id="cb9-400"><a href="#cb9-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-401"><a href="#cb9-401" aria-hidden="true" tabindex="-1"></a><span class="in">* 创建 id 变量并赋值</span></span>
<span id="cb9-402"><a href="#cb9-402" aria-hidden="true" tabindex="-1"></a><span class="in">gen id = _n</span></span>
<span id="cb9-403"><a href="#cb9-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-404"><a href="#cb9-404" aria-hidden="true" tabindex="-1"></a><span class="in">sort id year</span></span>
<span id="cb9-405"><a href="#cb9-405" aria-hidden="true" tabindex="-1"></a><span class="in">xtset id year</span></span>
<span id="cb9-406"><a href="#cb9-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-407"><a href="#cb9-407" aria-hidden="true" tabindex="-1"></a><span class="in">*- 次均费用，需要查看总费用是否和各项目费用加总一致，此处不一致</span></span>
<span id="cb9-408"><a href="#cb9-408" aria-hidden="true" tabindex="-1"></a><span class="in">* gen Cost = 总费用 / 次数 </span></span>
<span id="cb9-409"><a href="#cb9-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-410"><a href="#cb9-410" aria-hidden="true" tabindex="-1"></a><span class="in">*- 住院天数</span></span>
<span id="cb9-411"><a href="#cb9-411" aria-hidden="true" tabindex="-1"></a><span class="in">gen Day = 住院天数</span></span>
<span id="cb9-412"><a href="#cb9-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-413"><a href="#cb9-413" aria-hidden="true" tabindex="-1"></a><span class="in">*- DIP政策</span></span>
<span id="cb9-414"><a href="#cb9-414" aria-hidden="true" tabindex="-1"></a><span class="in">gen DIP = .</span></span>
<span id="cb9-415"><a href="#cb9-415" aria-hidden="true" tabindex="-1"></a><span class="in">replace DIP = 0 if year == 2018</span></span>
<span id="cb9-416"><a href="#cb9-416" aria-hidden="true" tabindex="-1"></a><span class="in">replace DIP = 0 if year == 2019</span></span>
<span id="cb9-417"><a href="#cb9-417" aria-hidden="true" tabindex="-1"></a><span class="in">replace DIP = 0 if year == 2020</span></span>
<span id="cb9-418"><a href="#cb9-418" aria-hidden="true" tabindex="-1"></a><span class="in">replace DIP = 0 if year == 2021</span></span>
<span id="cb9-419"><a href="#cb9-419" aria-hidden="true" tabindex="-1"></a><span class="in">replace DIP = 1 if year == 2022</span></span>
<span id="cb9-420"><a href="#cb9-420" aria-hidden="true" tabindex="-1"></a><span class="in">replace DIP = 1 if year == 2023</span></span>
<span id="cb9-421"><a href="#cb9-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-422"><a href="#cb9-422" aria-hidden="true" tabindex="-1"></a><span class="in">*- 控制变量序列</span></span>
<span id="cb9-423"><a href="#cb9-423" aria-hidden="true" tabindex="-1"></a><span class="in">*- 年龄</span></span>
<span id="cb9-424"><a href="#cb9-424" aria-hidden="true" tabindex="-1"></a><span class="in">gen Age = 年龄</span></span>
<span id="cb9-425"><a href="#cb9-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-426"><a href="#cb9-426" aria-hidden="true" tabindex="-1"></a><span class="in">*- 性别（虚拟变量；当受访者性别为女性时，赋值为"0"，否则为"1"）</span></span>
<span id="cb9-427"><a href="#cb9-427" aria-hidden="true" tabindex="-1"></a><span class="in">gen Gender = 0 if 性别 == "女"</span></span>
<span id="cb9-428"><a href="#cb9-428" aria-hidden="true" tabindex="-1"></a><span class="in">recode Gender .= 1</span></span>
<span id="cb9-429"><a href="#cb9-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-430"><a href="#cb9-430" aria-hidden="true" tabindex="-1"></a><span class="in">*- 婚姻（虚拟变量；当受访者已婚时，赋值为"1"，否则为"0"）</span></span>
<span id="cb9-431"><a href="#cb9-431" aria-hidden="true" tabindex="-1"></a><span class="in">gen Marriage = 1 if 婚姻 == "已婚"</span></span>
<span id="cb9-432"><a href="#cb9-432" aria-hidden="true" tabindex="-1"></a><span class="in">recode Marriage .= 0</span></span>
<span id="cb9-433"><a href="#cb9-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-434"><a href="#cb9-434" aria-hidden="true" tabindex="-1"></a><span class="in">*- 药物过敏</span></span>
<span id="cb9-435"><a href="#cb9-435" aria-hidden="true" tabindex="-1"></a><span class="in">gen Sensitive = 1 if 是否药物过敏 == "有"</span></span>
<span id="cb9-436"><a href="#cb9-436" aria-hidden="true" tabindex="-1"></a><span class="in">recode Sensitive .= 0</span></span>
<span id="cb9-437"><a href="#cb9-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-438"><a href="#cb9-438" aria-hidden="true" tabindex="-1"></a><span class="in">*- 是否手术</span></span>
<span id="cb9-439"><a href="#cb9-439" aria-hidden="true" tabindex="-1"></a><span class="in">gen Opera = 1 if 手术费 &gt; 0</span></span>
<span id="cb9-440"><a href="#cb9-440" aria-hidden="true" tabindex="-1"></a><span class="in">replace Cmedicine = 0 if 手术费 == 0</span></span>
<span id="cb9-441"><a href="#cb9-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-442"><a href="#cb9-442" aria-hidden="true" tabindex="-1"></a><span class="in">*- 职业</span></span>
<span id="cb9-443"><a href="#cb9-443" aria-hidden="true" tabindex="-1"></a><span class="in">gen Career = 1 if strmatch(职业, "*农*")</span></span>
<span id="cb9-444"><a href="#cb9-444" aria-hidden="true" tabindex="-1"></a><span class="in">replace Career = 2 if strmatch(职业, "*职*")</span></span>
<span id="cb9-445"><a href="#cb9-445" aria-hidden="true" tabindex="-1"></a><span class="in">replace Career = 3 if strmatch(职业, "*无业*")</span></span>
<span id="cb9-446"><a href="#cb9-446" aria-hidden="true" tabindex="-1"></a><span class="in">replace Career = 4 if Career == .</span></span>
<span id="cb9-447"><a href="#cb9-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-448"><a href="#cb9-448" aria-hidden="true" tabindex="-1"></a><span class="in">*- 是否共病</span></span>
<span id="cb9-449"><a href="#cb9-449" aria-hidden="true" tabindex="-1"></a><span class="in">gen Comorbidity = 1 if comorbidity == 1</span></span>
<span id="cb9-450"><a href="#cb9-450" aria-hidden="true" tabindex="-1"></a><span class="in">replace Comorbidity = 0 if comorbidity == 0</span></span>
<span id="cb9-451"><a href="#cb9-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-452"><a href="#cb9-452" aria-hidden="true" tabindex="-1"></a><span class="in">* 疾病类型按照 ICD-10 划分</span></span>
<span id="cb9-453"><a href="#cb9-453" aria-hidden="true" tabindex="-1"></a><span class="in">gen Disease = icd_chapter</span></span>
<span id="cb9-454"><a href="#cb9-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-455"><a href="#cb9-455" aria-hidden="true" tabindex="-1"></a><span class="in">gen Insurance = 1 if strmatch(医疗付费方式, "*自费*")</span></span>
<span id="cb9-456"><a href="#cb9-456" aria-hidden="true" tabindex="-1"></a><span class="in">replace Insurance = 2 if strmatch(医疗付费方式, "*商业*")</span></span>
<span id="cb9-457"><a href="#cb9-457" aria-hidden="true" tabindex="-1"></a><span class="in">replace Insurance = 3 if strmatch(医疗付费方式, "*城乡居民*")</span></span>
<span id="cb9-458"><a href="#cb9-458" aria-hidden="true" tabindex="-1"></a><span class="in">replace Insurance = 3 if strmatch(医疗付费方式, "*城镇居民*")</span></span>
<span id="cb9-459"><a href="#cb9-459" aria-hidden="true" tabindex="-1"></a><span class="in">replace Insurance = 4 if strmatch(医疗付费方式, "*城镇职工*")</span></span>
<span id="cb9-460"><a href="#cb9-460" aria-hidden="true" tabindex="-1"></a><span class="in">replace Insurance = 5 if strmatch(医疗付费方式, "*贫困救助*")</span></span>
<span id="cb9-461"><a href="#cb9-461" aria-hidden="true" tabindex="-1"></a><span class="in">replace Insurance = 6 if strmatch(医疗付费方式, "*新型农村合作*")</span></span>
<span id="cb9-462"><a href="#cb9-462" aria-hidden="true" tabindex="-1"></a><span class="in">replace Insurance = 7 if strmatch(医疗付费方式, "*全公费*")</span></span>
<span id="cb9-463"><a href="#cb9-463" aria-hidden="true" tabindex="-1"></a><span class="in">replace Insurance = 2 if Insurance == .</span></span>
<span id="cb9-464"><a href="#cb9-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-465"><a href="#cb9-465" aria-hidden="true" tabindex="-1"></a><span class="in">*- 是否使用中药</span></span>
<span id="cb9-466"><a href="#cb9-466" aria-hidden="true" tabindex="-1"></a><span class="in">gen Cmedicine = 1 if 中成药费 &gt; 0</span></span>
<span id="cb9-467"><a href="#cb9-467" aria-hidden="true" tabindex="-1"></a><span class="in">replace Cmedicine = 1 if 中草药费 &gt; 0</span></span>
<span id="cb9-468"><a href="#cb9-468" aria-hidden="true" tabindex="-1"></a><span class="in">replace Cmedicine = 0 if Cmedicine == .</span></span>
<span id="cb9-469"><a href="#cb9-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-470"><a href="#cb9-470" aria-hidden="true" tabindex="-1"></a><span class="in">*- 入院途径</span></span>
<span id="cb9-471"><a href="#cb9-471" aria-hidden="true" tabindex="-1"></a><span class="in">gen category = 1 if 入院途径 == "门诊"</span></span>
<span id="cb9-472"><a href="#cb9-472" aria-hidden="true" tabindex="-1"></a><span class="in">replace category = 0 if 入院途径 == "急诊"</span></span>
<span id="cb9-473"><a href="#cb9-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-474"><a href="#cb9-474" aria-hidden="true" tabindex="-1"></a><span class="in">*- 自付金额</span></span>
<span id="cb9-475"><a href="#cb9-475" aria-hidden="true" tabindex="-1"></a><span class="in">gen SelfCost = 自付金额 / 次数</span></span>
<span id="cb9-476"><a href="#cb9-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-477"><a href="#cb9-477" aria-hidden="true" tabindex="-1"></a><span class="in">*- 除去空值变量</span></span>
<span id="cb9-478"><a href="#cb9-478" aria-hidden="true" tabindex="-1"></a><span class="in">drop 其他费用 病理诊断费 临床物理治疗费 手术治疗费 康复费 中医治疗费 抗菌药物费用 白蛋白类制品费 球蛋白类制品费 凝血因子类制品费 细胞因子类制品费 检查用一次性医用材料费 治疗用一次性医用材料费 手术用一次性医用材料费</span></span>
<span id="cb9-479"><a href="#cb9-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-480"><a href="#cb9-480" aria-hidden="true" tabindex="-1"></a><span class="in">*- 费用变量数据</span></span>
<span id="cb9-481"><a href="#cb9-481" aria-hidden="true" tabindex="-1"></a><span class="in">gen GService = 一般医疗服务费 / 次数</span></span>
<span id="cb9-482"><a href="#cb9-482" aria-hidden="true" tabindex="-1"></a><span class="in">* gen GOperate = 一般治疗操作费 / 次数</span></span>
<span id="cb9-483"><a href="#cb9-483" aria-hidden="true" tabindex="-1"></a><span class="in">gen GSurgery = 手术费 / 次数</span></span>
<span id="cb9-484"><a href="#cb9-484" aria-hidden="true" tabindex="-1"></a><span class="in">gen GNurse = 护理费 / 次数</span></span>
<span id="cb9-485"><a href="#cb9-485" aria-hidden="true" tabindex="-1"></a><span class="in">gen GNonoperate = 非手术治疗项目费 / 次数</span></span>
<span id="cb9-486"><a href="#cb9-486" aria-hidden="true" tabindex="-1"></a><span class="in">gen GNarcosis = 麻醉费 / 次数</span></span>
<span id="cb9-487"><a href="#cb9-487" aria-hidden="true" tabindex="-1"></a><span class="in">gen GDrug = 西药费 / 次数</span></span>
<span id="cb9-488"><a href="#cb9-488" aria-hidden="true" tabindex="-1"></a><span class="in">gen GBlood = 血费 / 次数</span></span>
<span id="cb9-489"><a href="#cb9-489" aria-hidden="true" tabindex="-1"></a><span class="in">gen Others = 其他费 / 次数</span></span>
<span id="cb9-490"><a href="#cb9-490" aria-hidden="true" tabindex="-1"></a><span class="in">// 计算行总和</span></span>
<span id="cb9-491"><a href="#cb9-491" aria-hidden="true" tabindex="-1"></a><span class="in">egen temp_total_diagnose = rowtotal(实验室诊断费 影像学诊断费 临床诊断项目费)</span></span>
<span id="cb9-492"><a href="#cb9-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-493"><a href="#cb9-493" aria-hidden="true" tabindex="-1"></a><span class="in">// 进行除法运算</span></span>
<span id="cb9-494"><a href="#cb9-494" aria-hidden="true" tabindex="-1"></a><span class="in">gen GDiagnose = temp_total_diagnose / 次数</span></span>
<span id="cb9-495"><a href="#cb9-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-496"><a href="#cb9-496" aria-hidden="true" tabindex="-1"></a><span class="in">// 删除临时变量</span></span>
<span id="cb9-497"><a href="#cb9-497" aria-hidden="true" tabindex="-1"></a><span class="in">drop temp_total_diagnose</span></span>
<span id="cb9-498"><a href="#cb9-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-499"><a href="#cb9-499" aria-hidden="true" tabindex="-1"></a><span class="in">// 计算行总和</span></span>
<span id="cb9-500"><a href="#cb9-500" aria-hidden="true" tabindex="-1"></a><span class="in">egen temp_total_cdrug = rowtotal(中成药费 中草药费)</span></span>
<span id="cb9-501"><a href="#cb9-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-502"><a href="#cb9-502" aria-hidden="true" tabindex="-1"></a><span class="in">// 进行除法运算</span></span>
<span id="cb9-503"><a href="#cb9-503" aria-hidden="true" tabindex="-1"></a><span class="in">gen GCDrug = temp_total_cdrug / 次数</span></span>
<span id="cb9-504"><a href="#cb9-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-505"><a href="#cb9-505" aria-hidden="true" tabindex="-1"></a><span class="in">// 删除临时变量</span></span>
<span id="cb9-506"><a href="#cb9-506" aria-hidden="true" tabindex="-1"></a><span class="in">drop temp_total_cdrug</span></span>
<span id="cb9-507"><a href="#cb9-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-508"><a href="#cb9-508" aria-hidden="true" tabindex="-1"></a><span class="in">*- 次均费用</span></span>
<span id="cb9-509"><a href="#cb9-509" aria-hidden="true" tabindex="-1"></a><span class="in">egen Cost = rowtotal(GService GSurgery GNurse GNonoperate GNarcosis GDrug GBlood GDiagnose GCDrug Others) </span></span>
<span id="cb9-510"><a href="#cb9-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-511"><a href="#cb9-511" aria-hidden="true" tabindex="-1"></a><span class="in">*- 对变量进行排序</span></span>
<span id="cb9-512"><a href="#cb9-512" aria-hidden="true" tabindex="-1"></a><span class="in">order id year Cost SelfCost Day DIP Age Gender Marriage Sensitive Opera Career Disease Comorbidity Insurance Cmedicine category GService GSurgery GNurse GNonoperate GNarcosis GDrug GCDrug GBlood GDiagnose Others</span></span>
<span id="cb9-513"><a href="#cb9-513" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-514"><a href="#cb9-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-515"><a href="#cb9-515" aria-hidden="true" tabindex="-1"></a><span class="fu">## 数据分析</span></span>
<span id="cb9-516"><a href="#cb9-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-517"><a href="#cb9-517" aria-hidden="true" tabindex="-1"></a><span class="fu">### 描述性统计</span></span>
<span id="cb9-518"><a href="#cb9-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-519"><a href="#cb9-519" aria-hidden="true" tabindex="-1"></a><span class="in">``` {#descriptive .stata style="color"}</span></span>
<span id="cb9-520"><a href="#cb9-520" aria-hidden="true" tabindex="-1"></a><span class="in">// 描述性统计 保留小数点后两位</span></span>
<span id="cb9-521"><a href="#cb9-521" aria-hidden="true" tabindex="-1"></a><span class="in">estpost summarize Cost SelfCost Day DIP Age Gender Marriage Sensitive Opera Career Disease Comorbidity Insurance Cmedicine category GService GSurgery GNurse GNonoperate GNarcosis GDrug GCDrug GBlood GDiagnose, detail</span></span>
<span id="cb9-522"><a href="#cb9-522" aria-hidden="true" tabindex="-1"></a><span class="in">esttab, cells("count mean(fmt(2)) sd(fmt(2)) min(fmt(2)) p50(fmt(2)) max(fmt(2))") noobs compress replace title(Descriptive statistics)</span></span>
<span id="cb9-523"><a href="#cb9-523" aria-hidden="true" tabindex="-1"></a><span class="in">esttab using "C:\Users\asus\Desktop\test\stata\ICD-10\25.02.09\analysis-result\描述性统计0218.rtf", cells("count mean(fmt(2)) sd(fmt(2)) min(fmt(2)) p50(fmt(2)) max(fmt(2))") noobs compress replace title(Descriptive statistics)</span></span>
<span id="cb9-524"><a href="#cb9-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-525"><a href="#cb9-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-526"><a href="#cb9-526" aria-hidden="true" tabindex="-1"></a><span class="in">// 全样本费用指标</span></span>
<span id="cb9-527"><a href="#cb9-527" aria-hidden="true" tabindex="-1"></a><span class="in">tabstat Cost SelfCost Day GService GSurgery GNurse GNonoperate GNarcosis GDrug GCDrug GBlood GDiagnose Others, s(mean) by(year)</span></span>
<span id="cb9-528"><a href="#cb9-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-529"><a href="#cb9-529" aria-hidden="true" tabindex="-1"></a><span class="in">// 变量指标</span></span>
<span id="cb9-530"><a href="#cb9-530" aria-hidden="true" tabindex="-1"></a><span class="in">tabstat Cost SelfCost Day DIP Age Gender Marriage Sensitive Opera Career Disease Comorbidity Insurance Cmedicine category, s(mean) by(year)</span></span>
<span id="cb9-531"><a href="#cb9-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-532"><a href="#cb9-532" aria-hidden="true" tabindex="-1"></a><span class="in">* 计算所有年份的均值</span></span>
<span id="cb9-533"><a href="#cb9-533" aria-hidden="true" tabindex="-1"></a><span class="in">summarize Cost SelfCost Day GService GSurgery GNurse GNonoperate GNarcosis GDrug GCDrug GBlood GDiagnose Others</span></span>
<span id="cb9-534"><a href="#cb9-534" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-535"><a href="#cb9-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-536"><a href="#cb9-536" aria-hidden="true" tabindex="-1"></a><span class="fu">### 回归分析</span></span>
<span id="cb9-537"><a href="#cb9-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-538"><a href="#cb9-538" aria-hidden="true" tabindex="-1"></a>为了稳健性，对因变量进行缩尾处理。</span>
<span id="cb9-539"><a href="#cb9-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-540"><a href="#cb9-540" aria-hidden="true" tabindex="-1"></a><span class="in">``` {#regression .stata style="color"}</span></span>
<span id="cb9-541"><a href="#cb9-541" aria-hidden="true" tabindex="-1"></a><span class="in">*- 缩尾处理（目的：剔除异常值；剔除的比例根据研究而定）</span></span>
<span id="cb9-542"><a href="#cb9-542" aria-hidden="true" tabindex="-1"></a><span class="in">winsor2 Cost Day Age, replace cuts(1, 99)</span></span>
<span id="cb9-543"><a href="#cb9-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-544"><a href="#cb9-544" aria-hidden="true" tabindex="-1"></a><span class="in">// 全局暂元</span></span>
<span id="cb9-545"><a href="#cb9-545" aria-hidden="true" tabindex="-1"></a><span class="in">global Control Age Gender Career Marriage category Disease Opera Comorbidity Cmedicine Insurance </span></span>
<span id="cb9-546"><a href="#cb9-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-547"><a href="#cb9-547" aria-hidden="true" tabindex="-1"></a><span class="in">// 基准模型</span></span>
<span id="cb9-548"><a href="#cb9-548" aria-hidden="true" tabindex="-1"></a><span class="in">reg Cost DIP $Control, r</span></span>
<span id="cb9-549"><a href="#cb9-549" aria-hidden="true" tabindex="-1"></a><span class="in">est store m1</span></span>
<span id="cb9-550"><a href="#cb9-550" aria-hidden="true" tabindex="-1"></a><span class="in">reg SelfCost DIP $Control, r</span></span>
<span id="cb9-551"><a href="#cb9-551" aria-hidden="true" tabindex="-1"></a><span class="in">est store m2</span></span>
<span id="cb9-552"><a href="#cb9-552" aria-hidden="true" tabindex="-1"></a><span class="in">reg Day DIP $Control Sensitive, r // Sensitive 只在Day的模型中出现</span></span>
<span id="cb9-553"><a href="#cb9-553" aria-hidden="true" tabindex="-1"></a><span class="in">est store m3</span></span>
<span id="cb9-554"><a href="#cb9-554" aria-hidden="true" tabindex="-1"></a><span class="in">reg Cost DIP $Control Day, r</span></span>
<span id="cb9-555"><a href="#cb9-555" aria-hidden="true" tabindex="-1"></a><span class="in">est store m4</span></span>
<span id="cb9-556"><a href="#cb9-556" aria-hidden="true" tabindex="-1"></a><span class="in">reg SelfCost DIP $Control Day, r</span></span>
<span id="cb9-557"><a href="#cb9-557" aria-hidden="true" tabindex="-1"></a><span class="in">est store m5</span></span>
<span id="cb9-558"><a href="#cb9-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-559"><a href="#cb9-559" aria-hidden="true" tabindex="-1"></a><span class="in">* 输出基准模型结果</span></span>
<span id="cb9-560"><a href="#cb9-560" aria-hidden="true" tabindex="-1"></a><span class="in">esttab m1 m2 m3 m4 m5 using "C:\Users\asus\Desktop\test\stata\ICD-10\25.02.09\analysis-result0218\基准模型结果.rtf", replace b(2) t(2) ar2 star(* 0.1 ** 0.05 *** 0.01) nogap</span></span>
<span id="cb9-561"><a href="#cb9-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-562"><a href="#cb9-562" aria-hidden="true" tabindex="-1"></a><span class="in">// 调节效应分析</span></span>
<span id="cb9-563"><a href="#cb9-563" aria-hidden="true" tabindex="-1"></a><span class="in">global Control Age Gender Career Marriage Disease Opera Comorbidity Cmedicine Insurance</span></span>
<span id="cb9-564"><a href="#cb9-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-565"><a href="#cb9-565" aria-hidden="true" tabindex="-1"></a><span class="in">reg Cost DIP $Control Day if category == 1, r</span></span>
<span id="cb9-566"><a href="#cb9-566" aria-hidden="true" tabindex="-1"></a><span class="in">est store m1</span></span>
<span id="cb9-567"><a href="#cb9-567" aria-hidden="true" tabindex="-1"></a><span class="in">reg Cost DIP $Control Day if category == 0, r</span></span>
<span id="cb9-568"><a href="#cb9-568" aria-hidden="true" tabindex="-1"></a><span class="in">est store m2</span></span>
<span id="cb9-569"><a href="#cb9-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-570"><a href="#cb9-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-571"><a href="#cb9-571" aria-hidden="true" tabindex="-1"></a><span class="in">*- esttab m1 m2 m3 using </span></span>
<span id="cb9-572"><a href="#cb9-572" aria-hidden="true" tabindex="-1"></a><span class="in">esttab m1 m2 using "C:\Users\asus\Desktop\test\stata\ICD-10\25.02.09\analysis-result0218\调节效应结果-cost&amp;dip.rtf", replace b(2) t(2) ar2 star(* 0.1 ** 0.05 *** 0.01) nogap</span></span>
<span id="cb9-573"><a href="#cb9-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-574"><a href="#cb9-574" aria-hidden="true" tabindex="-1"></a><span class="in">reg SelfCost DIP $Control Day if category==1, r</span></span>
<span id="cb9-575"><a href="#cb9-575" aria-hidden="true" tabindex="-1"></a><span class="in">est store m1</span></span>
<span id="cb9-576"><a href="#cb9-576" aria-hidden="true" tabindex="-1"></a><span class="in">reg SelfCost DIP $Control Day if category==0, r</span></span>
<span id="cb9-577"><a href="#cb9-577" aria-hidden="true" tabindex="-1"></a><span class="in">est store m2</span></span>
<span id="cb9-578"><a href="#cb9-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-579"><a href="#cb9-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-580"><a href="#cb9-580" aria-hidden="true" tabindex="-1"></a><span class="in">esttab m1 m2 using "C:\Users\asus\Desktop\test\stata\ICD-10\25.02.09\analysis-result0218\调节效应结果-self&amp;dip.rtf", replace b(2) t(2) ar2 star(* 0.1 ** 0.05 *** 0.01) nogap</span></span>
<span id="cb9-581"><a href="#cb9-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-582"><a href="#cb9-582" aria-hidden="true" tabindex="-1"></a><span class="in">reg Day DIP $Control Sensitive if category==1, r</span></span>
<span id="cb9-583"><a href="#cb9-583" aria-hidden="true" tabindex="-1"></a><span class="in">est store m1</span></span>
<span id="cb9-584"><a href="#cb9-584" aria-hidden="true" tabindex="-1"></a><span class="in">reg Day DIP $Control Sensitive if category==0, r</span></span>
<span id="cb9-585"><a href="#cb9-585" aria-hidden="true" tabindex="-1"></a><span class="in">est store m2</span></span>
<span id="cb9-586"><a href="#cb9-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-587"><a href="#cb9-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-588"><a href="#cb9-588" aria-hidden="true" tabindex="-1"></a><span class="in">esttab m1 m2 using "C:\Users\asus\Desktop\test\stata\ICD-10\25.02.09\analysis-result0218\调节效应结果-day&amp;dip.rtf", replace b(2) t(2) ar2 star(* 0.1 ** 0.05 *** 0.01) nogap</span></span>
<span id="cb9-589"><a href="#cb9-589" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="复制到剪贴板" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 This website was built with Quarto
  </li>  
</ul>
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2023-2025, simonzhou</p>
<div class="toc-actions"><ul><li><a href="https://github.com/zhoulvbang/Med-Stat-Notes/blob/main/Guide/Python/2025-02-20-Medical-expenses.qmd" class="toc-action"><i class="bi bi-github"></i>查看代码</a></li><li><a href="https://github.com/zhoulvbang/Med-Stat-Notes/issues/new" class="toc-action"><i class="bi empty"></i>反馈问题</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/zhoulvbang">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>